[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Special Areas for Bird Conservation",
    "section": "",
    "text": "Preface\n\nProtected areas (Hanson, 2022, 2024; UNEP-WCMC and IUCN, 2024b, 2024a)\nKey Biodiveristy Areas (BirdLife International, 2025)\n\n\n\n\nHanson, J. O. 2022. Wdpar: Interface to the world database on protected areas, Journal of Open Source Software, vol. 7, 4594\n\nHanson, J. O. 2024. Wdpar: Interface to the world database on protected areas\n\nUNEP-WCMC and IUCN. 2024b. Protected planet: The world database on protected areas (WDPA), Cambridge, UK, UNEP-WCMC; IUCN\n\nUNEP-WCMC and IUCN. 2024a. Protected planet: The world database on other effective area-based conservation measures, Cambridge, UK, UNEP-WCMC; IUCN\n\nBirdLife International. 2025. Digital boundaries of key biodiversity areas from the world database of key biodiversity areas",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "argentina.html",
    "href": "argentina.html",
    "title": "Argentina",
    "section": "",
    "text": "Key Biodiversity Areas (KBAs)",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Argentina</span>"
    ]
  },
  {
    "objectID": "argentina.html#first-stats",
    "href": "argentina.html#first-stats",
    "title": "Argentina",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nfile_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.shp$',\n  full.names = T\n)\n\ndf_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.xlsx$',\n  full.names = T\n)\n# readxl::excel_sheets(df_list)\n\nkbas_0 &lt;- lapply(file_list, read_sf) |&gt;\n  bind_rows() |&gt;\n  janitor::clean_names()\n\n\nkbas &lt;- kbas_0 |&gt;\n  filter(country == 'Argentina')\n\n\ndf &lt;- readxl::read_xlsx(df_list) |&gt;\n  janitor::clean_names() |&gt;\n  filter(sit_rec_id %in% kbas$sit_rec_id)\n\n\nkbas_1 &lt;- kbas |&gt;\n  left_join(df) |&gt;\n  select(\n    sit_rec_id,\n    nat_name,\n    int_name,\n    kba_status,\n    ends_with('status'),\n    class,\n    taxon_id,\n    common_name,\n    scientific_name,\n    kba_criterias,\n    year\n  )\n\nkbas_2 &lt;- kbas_1 |&gt;\n  mutate(\n    class = str_to_title(class),\n    triggered_by_class = if_else(!is.na(kba_criterias), class, 'none'),\n    triggered_by_scinam = if_else(\n      !is.na(kba_criterias),\n      scientific_name,\n      'none'\n    )\n  )\n\nkba_3 &lt;- kbas_2 |&gt;\n  distinct(sit_rec_id, class, triggered_by_class, year) |&gt;\n  arrange(class) |&gt;\n  group_by(sit_rec_id) |&gt;\n  summarise(\n    class = paste0(class, collapse = ', '),\n    triggered_by = paste0(triggered_by_class, collapse = ', '),\n    triggered_by_birds = if_else(str_detect(triggered_by, 'Aves'), 1, 0),\n    year = unique(year)\n  ) |&gt;\n  mutate(\n    contain = case_when(\n      class == 'Aves' ~ 'Only birds',\n      str_detect(class, 'Aves') ~ 'Birds and others',\n      !str_detect(class, 'Aves') ~ 'No birds',\n\n      TRUE ~ 'check'\n    )\n  )\n\n\nkba_3$triggered_by &lt;- str_remove_all(kba_3$triggered_by, 'none|, ')\n\n# kba_3 |&gt;\n#   count(contain, triggered_by_birds)\n\nkbas_leaflet &lt;- kbas_2 |&gt;\n  mutate(\n    sci_name_class = paste0(scientific_name, ' (', class, ')'),\n    comm_name_class = paste0(common_name, ' (', class, ')')\n  ) |&gt;\n  arrange(class) |&gt;\n  # select(class, scientific_name, sci_name_class) |&gt;\n  group_by(sit_rec_id, int_name, nat_name, kba_status, year) |&gt;\n  summarise(\n    scientific_name = paste0(sci_name_class, collapse = ', '),\n    common_name = paste0(comm_name_class, collapse = ', ')\n  ) |&gt;\n  left_join(kba_3) |&gt;\n  ungroup() %&gt;%\n  filter(st_geometry_type(.) != 'POINT') |&gt;\n  st_cast('MULTIPOLYGON')\n\n\nkbas_leaflet_c &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  count(contain, triggered_by_birds, sort = T) |&gt;\n  mutate(contain = forcats::as_factor(contain), n = as.integer(n))\n\nn_kbas &lt;- length(unique(kbas_leaflet$sit_rec_id))\n\n\nn_kba_birds &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  filter(contain != 'No birds') |&gt;\n  nrow()\n\n\n# kbas_leaflet_c |&gt;\n#   ggplot() +\n#   aes(y = contain, x = n, fill = n) +\n#   geom_col() +\n#   theme_minimal()\nkbas_leaflet_c |&gt;\n  mutate(\n    triggered_by_birds = if_else(triggered_by_birds == '1', 'Yes', 'No'),\n    triggered_by_birds = factor(triggered_by_birds, levels = c('Yes', 'No'))\n  ) |&gt;\n  arrange(triggered_by_birds, contain) \n\n\n# A tibble: 5 × 3\n  contain          triggered_by_birds     n\n  &lt;fct&gt;            &lt;fct&gt;              &lt;int&gt;\n1 Birds and others Yes                  135\n2 Only birds       Yes                    6\n3 Birds and others No                     2\n4 Only birds       No                   114\n5 No birds         No                    24\n\n\nCode\n  # ggplot() +\n  # aes(x = contain, y = n, fill = triggered_by_birds) +\n  # geom_col() +\n  # labs(x = NULL, y = 'Count') +\n\n  # scale_fill_manual('Triggered by birds?', values = c('#333333', '#d6d4cfff')) +\n  # # scale_fill_manual('Triggered by birds?', values = c('#7D804BFF', '#E6EEE0FF')) +\n  # theme_minimal() +\n  # theme(\n  #   legend.position = 'bottom',\n  #   plot.background = element_rect(fill = background_colour),\n  #   axis.title = element_text(family = 'worksans')\n  # )\n\n\n\n\n\n\n\n\n\n\nTotal number of KBAs\n\n\n\n281\n\n\n\n\n\n\n\n\n\n\nNumber of KBAs with Birds\n\n\n\n257\n\n\n\n\n\n\nCode\n# glimpse(raw_pa_data)\n# st_geometry_type(raw_pa_data) == 'MULTIPOLYGON'\nraw_pa_data_pols &lt;- raw_pa_data |&gt;\n  filter(st_geometry_type(raw_pa_data) == 'MULTIPOLYGON') |&gt;\n  mutate(\n    iucn_cat = factor(\n      iucn_cat,\n      levels = c(\n        'Ia',\n        'Ib',\n        'II',\n        'III',\n        'IV',\n        'V',\n        'VI',\n        'Not Applicable',\n        'Not Reported',\n        'Not Assigned'\n      )\n    ),\n    realm = factor(realm, levels = c('Coastal', 'Marine', 'Terrestrial'))\n  )\n\n# raw_pa_data_pols$iucn_cat\n# raw_pa_data |&gt;\n#   st_drop_geometry() |&gt;\n#   count(status)",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Argentina</span>"
    ]
  },
  {
    "objectID": "argentina.html#kbas-map",
    "href": "argentina.html#kbas-map",
    "title": "Argentina",
    "section": "KBAs map",
    "text": "KBAs map\n\n\nCode\n# kbas_leaflet$contain |&gt; unique() |&gt; sort()\n\nkbas_leaflet &lt;- kbas_leaflet |&gt;\n  arrange(contain) |&gt;\n  mutate(contain = forcats::as_factor(contain))\n\n\npal_kbas &lt;- colorFactor(\n  domain = levels(kbas_leaflet$contain),\n  palette = c('#2e6ba6', '#e53d3d', '#59de9e')\n)\n\niucn_palette &lt;- tribble(\n  ~id, ~cat, ~hex_colour,\n  'Ia', 'Ia Strict nature reserve', '#174721', \n  'Ib', 'Ib Wilderness area', '#7AC141',\n  'II', 'II National park', '#5D873B',\n  'III', 'III Natural monument or feature', '#AFBD36',\n  'IV', 'IV Habitat/species management area', '#C8DF8D',\n  'V', 'V Protected landscape/seascape', '#15477C',\n  'VI', 'VI Protected area with sustainable use of natural resource', '#7EA1B5',\n  'Not Applicable', 'NA Not Applicable', '#894444',\n  'Not Assigned', 'NAS Not Assigned', '#E60000',\n  'Not Reported', 'NR Not Reported', '#898944'\n)\n\niucn_palette &lt;- iucn_palette |&gt; \n  filter(id %in% levels(raw_pa_data_pols$iucn_cat))\n\npal &lt;- colorFactor(\n  domain = levels(raw_pa_data_pols$iucn_cat),\n  palette = iucn_palette$hex_colour\n)\n# pal &lt;- colorFactor(\n#   domain = levels(raw_pa_data_pols$iucn_cat),\n#   c(\n#     '#232021',\n#     '#426f41',\n#     '#59ba49',\n#     '#c1178d',\n#     '#feb016',\n#     '#e61e24'\n#   )\n# )\n\nbasemap_leaflet |&gt;\n  addPolygons(\n    data = kbas_leaflet,\n    fillOpacity = 1,\n    fillColor = ~ pal_kbas(contain),\n    stroke = TRUE,\n    color = '#333333',\n    weight = ~ (triggered_by_birds * 2) + 0.5,\n    opacity = 1,\n    group = 'KBAs',\n    # label = ~ htmltools::htmlEscape(desig_eng),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      kbas_leaflet$int_name,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;a href=\"https://www.keybiodiversityareas.org/site/factsheet/',\n      kbas_leaflet$sit_rec_id,\n      '/assessment\", target=\"_blank\"&gt;Factsheet&lt;/a&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Groups: &lt;/b&gt;',\n      kbas_leaflet$contain,\n      '&lt;/br&gt;',\n      '&lt;b&gt;National site name: &lt;/b&gt;',\n      kbas_leaflet$nat_name,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Triggered by: &lt;/b&gt;',\n      kbas_leaflet$triggered_by,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Year of last assessment: &lt;/b&gt;',\n      kbas_leaflet$year\n    )\n  ) |&gt;\n\n  addPolygons(\n    data = raw_pa_data_pols,\n    weight = 0.5,\n    fillOpacity = 0.7,\n    fillColor = ~ pal(iucn_cat),\n    # stroke = FALSE,\n    color = '#333333',\n    opacity = 0.7,\n    group = 'Protected areas',\n    label = ~ htmltools::htmlEscape(desig_eng),\n    # label = ~ htmltools::htmlEscape(iucn_cat),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      raw_pa_data_pols$name_eng,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Designation: &lt;/b&gt;',\n      raw_pa_data_pols$desig_eng,\n      '&lt;/br&gt;',\n      '&lt;b&gt;IUCN category: &lt;/b&gt;',\n      raw_pa_data_pols$iucn_cat,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Realm: &lt;/b&gt;',\n      raw_pa_data_pols$realm,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Status (year): &lt;/b&gt;',\n      raw_pa_data_pols$status,\n      ' (',\n      raw_pa_data_pols$status_yr,\n      ')'\n    )\n  ) |&gt;\n  addLegend(\n    data = kbas_leaflet,\n    pal = pal_kbas,\n    values = levels(kbas_leaflet$contain),\n    opacity = 0.9,\n    group = 'KBAs',\n    title = 'KBAs'\n  ) |&gt;\n  addLegend(\n    data = raw_pa_data_pols,\n    pal = pal,\n    values = levels(raw_pa_data_pols$iucn_cat),\n    opacity = 0.9,\n    group = 'Protected areas',\n    title = \"Protected areas &lt;/br&gt; IUCN cats\"\n  ) |&gt;\n  addLayersControl(\n    baseGroups = c(\n      # \"Topography\",\n      \"Open Street Map\",\n      \"Satellite\"\n      \n      # \"Terrain\",\n    ),\n    overlayGroups = c(\n      'KBAs',\n      'Protected areas'\n    ),\n    options = layersControlOptions(collapsed = FALSE, position = \"bottomright\")\n  ) |&gt;\n  hideGroup(c('Protected areas')) |&gt;\n  addScaleBar(position = c(\"bottomleft\"), options = scaleBarOptions())",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Argentina</span>"
    ]
  },
  {
    "objectID": "argentina.html#first-stats-1",
    "href": "argentina.html#first-stats-1",
    "title": "Argentina",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nraw_pa_data_pols |&gt;\n  st_drop_geometry() |&gt; \n  count(desig_eng) |&gt; \n  filter(str_detect(desig_eng, 'UNESCO-MAB'))\n\n\n# A tibble: 1 × 2\n  desig_eng                        n\n  &lt;chr&gt;                        &lt;int&gt;\n1 UNESCO-MAB Biosphere Reserve    17\n\n\n\n\nCode\ng_labels &lt;- levels(raw_pa_data_pols$iucn_cat)[\n  length(levels(raw_pa_data_pols$iucn_cat)):1\n]\nn_desig &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  pull(desig_eng) |&gt;\n  unique() |&gt;\n  length()\npas_count &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  st_drop_geometry() |&gt;\n  count(iucn_cat, desig_eng, realm) |&gt;\n  mutate(iucn_cat = factor(iucn_cat, levels = g_labels))\n\npalette_desig &lt;- paletteer::paletteer_c(\"scico::roma\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"viridis::viridis\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"scico::batlow\", n = n_desig)\n\nggplotly(\n  pas_count |&gt;\n    arrange(iucn_cat) |&gt;\n    ggplot() +\n    aes(y = iucn_cat, x = n, fill = desig_eng) +\n    geom_col() +\n    labs(y = 'IUCN categories', x = 'Count') +\n    scale_fill_manual(\n      values = palette_desig,\n      # labels = \\(x) stringr::str_wrap(x, width = 32),\n      # 'Designation'\n    ) +\n    theme_minimal() +\n    theme(\n      legend.position = 'none',\n      plot.background = element_rect(fill = background_colour),\n      axis.title = element_text(family = 'worksans')\n    ) +\n    facet_wrap(~realm, scales = 'free')\n) \n\n\n\n\n\n\n\n\nCode\nselect(iucn_palette, -hex_colour)\n\n\n# A tibble: 10 × 2\n   id             cat                                                       \n   &lt;chr&gt;          &lt;chr&gt;                                                     \n 1 Ia             Ia Strict nature reserve                                  \n 2 Ib             Ib Wilderness area                                        \n 3 II             II National park                                          \n 4 III            III Natural monument or feature                           \n 5 IV             IV Habitat/species management area                        \n 6 V              V Protected landscape/seascape                            \n 7 VI             VI Protected area with sustainable use of natural resource\n 8 Not Applicable NA Not Applicable                                         \n 9 Not Assigned   NAS Not Assigned                                          \n10 Not Reported   NR Not Reported                                           \n\n\n\n\nCode\ncolours_desig &lt;- tibble(palette_desig, desig = sort(unique(pas_count$desig_eng)))\nprep &lt;- colours_desig |&gt;\n  select(colour = palette_desig, desig_eng = desig) |&gt; \n  right_join(pas_count)\n\nprep |&gt; \n  reactable(\n    showSortable = T,\n    defaultSorted = list(n = 'desc'),\n    searchable = TRUE,\n    defaultPageSize = 20,\n    showPageSizeOptions = TRUE,\n    pageSizeOptions = c(10, 20, 50, 100, nrow(pas_count)),\n    fullWidth = F,\n    columns = list(\n      colour = colDef(\n        sortable = F,\n        name = '',\n        maxWidth = 100,\n        style = function(value) {\n          colour &lt;- value\n          list(background = colour, color = colour)\n        }\n      ),\n      desig_eng = colDef(\n        name = 'Designation',\n        minWidth = 400\n      ),\n      realm = colDef(\n        name = 'Realm'\n      ),\n      iucn_cat = colDef(\n        name = 'IUCN (cat)',\n        minWidth = 150\n      ),\n      n = colDef(\n        name = 'Count'\n      )\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Argentina</span>"
    ]
  },
  {
    "objectID": "bangladesh.html",
    "href": "bangladesh.html",
    "title": "Bangladesh",
    "section": "",
    "text": "Key Biodiversity Areas (KBAs)",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Bangladesh</span>"
    ]
  },
  {
    "objectID": "bangladesh.html#first-stats",
    "href": "bangladesh.html#first-stats",
    "title": "Bangladesh",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nfile_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.shp$',\n  full.names = T\n)\n\ndf_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.xlsx$',\n  full.names = T\n)\n# readxl::excel_sheets(df_list)\n\nkbas_0 &lt;- lapply(file_list, read_sf) |&gt;\n  bind_rows() |&gt;\n  janitor::clean_names()\n\n\nkbas &lt;- kbas_0 |&gt;\n  filter(country == 'Bangladesh')\n\n\ndf &lt;- readxl::read_xlsx(df_list) |&gt;\n  janitor::clean_names() |&gt;\n  filter(sit_rec_id %in% kbas$sit_rec_id)\n\n\nkbas_1 &lt;- kbas |&gt;\n  left_join(df) |&gt;\n  select(\n    sit_rec_id,\n    nat_name,\n    int_name,\n    kba_status,\n    ends_with('status'),\n    class,\n    taxon_id,\n    common_name,\n    scientific_name,\n    kba_criterias,\n    year\n  )\n\nkbas_2 &lt;- kbas_1 |&gt;\n  mutate(\n    class = str_to_title(class),\n    triggered_by_class = if_else(!is.na(kba_criterias), class, 'none'),\n    triggered_by_scinam = if_else(\n      !is.na(kba_criterias),\n      scientific_name,\n      'none'\n    )\n  )\n\nkba_3 &lt;- kbas_2 |&gt;\n  distinct(sit_rec_id, class, triggered_by_class, year) |&gt;\n  arrange(class) |&gt;\n  group_by(sit_rec_id) |&gt;\n  summarise(\n    class = paste0(class, collapse = ', '),\n    triggered_by = paste0(triggered_by_class, collapse = ', '),\n    triggered_by_birds = if_else(str_detect(triggered_by, 'Aves'), 1, 0),\n    year = unique(year)\n  ) |&gt;\n  mutate(\n    contain = case_when(\n      class == 'Aves' ~ 'Only birds',\n      str_detect(class, 'Aves') ~ 'Birds and others',\n      !str_detect(class, 'Aves') ~ 'No birds',\n\n      TRUE ~ 'check'\n    )\n  )\n\n\nkba_3$triggered_by &lt;- str_remove_all(kba_3$triggered_by, 'none|, ')\n\n# kba_3 |&gt;\n#   count(contain, triggered_by_birds)\n\nkbas_leaflet &lt;- kbas_2 |&gt;\n  mutate(\n    sci_name_class = paste0(scientific_name, ' (', class, ')'),\n    comm_name_class = paste0(common_name, ' (', class, ')')\n  ) |&gt;\n  arrange(class) |&gt;\n  # select(class, scientific_name, sci_name_class) |&gt;\n  group_by(sit_rec_id, int_name, nat_name, kba_status, year) |&gt;\n  summarise(\n    scientific_name = paste0(sci_name_class, collapse = ', '),\n    common_name = paste0(comm_name_class, collapse = ', ')\n  ) |&gt;\n  left_join(kba_3) |&gt;\n  ungroup() %&gt;%\n  filter(st_geometry_type(.) != 'POINT') |&gt;\n  st_cast('MULTIPOLYGON')\n\n\nkbas_leaflet_c &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  count(contain, triggered_by_birds, sort = T) |&gt;\n  mutate(contain = forcats::as_factor(contain), n = as.integer(n))\n\nn_kbas &lt;- length(unique(kbas_leaflet$sit_rec_id))\n\n\nn_kba_birds &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  filter(contain != 'No birds') |&gt;\n  nrow()\n\n\n# kbas_leaflet_c |&gt;\n#   ggplot() +\n#   aes(y = contain, x = n, fill = n) +\n#   geom_col() +\n#   theme_minimal()\nkbas_leaflet_c |&gt;\n  mutate(\n    triggered_by_birds = if_else(triggered_by_birds == '1', 'Yes', 'No'),\n    triggered_by_birds = factor(triggered_by_birds, levels = c('Yes', 'No'))\n  ) |&gt;\n  arrange(triggered_by_birds, contain) \n\n\n# A tibble: 3 × 3\n  contain    triggered_by_birds     n\n  &lt;fct&gt;      &lt;fct&gt;              &lt;int&gt;\n1 Only birds Yes                    1\n2 Only birds No                    12\n3 No birds   No                     7\n\n\nCode\n  # ggplot() +\n  # aes(x = contain, y = n, fill = triggered_by_birds) +\n  # geom_col() +\n  # labs(x = NULL, y = 'Count') +\n\n  # scale_fill_manual('Triggered by birds?', values = c('#333333', '#d6d4cfff')) +\n  # # scale_fill_manual('Triggered by birds?', values = c('#7D804BFF', '#E6EEE0FF')) +\n  # theme_minimal() +\n  # theme(\n  #   legend.position = 'bottom',\n  #   plot.background = element_rect(fill = background_colour),\n  #   axis.title = element_text(family = 'worksans')\n  # )\n\n\n\n\n\n\n\n\n\n\nTotal number of KBAs\n\n\n\n20\n\n\n\n\n\n\n\n\n\n\nNumber of KBAs with Birds\n\n\n\n13\n\n\n\n\n\n\nCode\n# glimpse(raw_pa_data)\n# st_geometry_type(raw_pa_data) == 'MULTIPOLYGON'\nraw_pa_data_pols &lt;- raw_pa_data |&gt;\n  filter(st_geometry_type(raw_pa_data) == 'MULTIPOLYGON') |&gt;\n  mutate(\n    iucn_cat = factor(\n      iucn_cat,\n      levels = c(\n        'Ia',\n        'Ib',\n        'II',\n        'III',\n        'IV',\n        'V',\n        'VI',\n        'Not Applicable',\n        'Not Reported',\n        'Not Assigned'\n      )\n    ),\n    realm = factor(realm, levels = c('Coastal', 'Marine', 'Terrestrial'))\n  )\n\n# raw_pa_data_pols$iucn_cat\n# raw_pa_data |&gt;\n#   st_drop_geometry() |&gt;\n#   count(status)",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Bangladesh</span>"
    ]
  },
  {
    "objectID": "bangladesh.html#kbas-map",
    "href": "bangladesh.html#kbas-map",
    "title": "Bangladesh",
    "section": "KBAs map",
    "text": "KBAs map\n\n\nCode\n# kbas_leaflet$contain |&gt; unique() |&gt; sort()\n\nkbas_leaflet &lt;- kbas_leaflet |&gt;\n  arrange(contain) |&gt;\n  mutate(contain = forcats::as_factor(contain))\n\n\npal_kbas &lt;- colorFactor(\n  domain = levels(kbas_leaflet$contain),\n  palette = c('#2e6ba6', '#e53d3d', '#59de9e')\n)\n\niucn_palette &lt;- tribble(\n  ~id, ~cat, ~hex_colour,\n  'Ia', 'Ia Strict nature reserve', '#174721', \n  'Ib', 'Ib Wilderness area', '#7AC141',\n  'II', 'II National park', '#5D873B',\n  'III', 'III Natural monument or feature', '#AFBD36',\n  'IV', 'IV Habitat/species management area', '#C8DF8D',\n  'V', 'V Protected landscape/seascape', '#15477C',\n  'VI', 'VI Protected area with sustainable use of natural resource', '#7EA1B5',\n  'Not Applicable', 'NA Not Applicable', '#894444',\n  'Not Assigned', 'NAS Not Assigned', '#E60000',\n  'Not Reported', 'NR Not Reported', '#898944'\n)\n\niucn_palette &lt;- iucn_palette |&gt; \n  filter(id %in% levels(raw_pa_data_pols$iucn_cat))\n\npal &lt;- colorFactor(\n  domain = levels(raw_pa_data_pols$iucn_cat),\n  palette = iucn_palette$hex_colour\n)\n# pal &lt;- colorFactor(\n#   domain = levels(raw_pa_data_pols$iucn_cat),\n#   c(\n#     '#232021',\n#     '#426f41',\n#     '#59ba49',\n#     '#c1178d',\n#     '#feb016',\n#     '#e61e24'\n#   )\n# )\n\nbasemap_leaflet |&gt;\n  addPolygons(\n    data = kbas_leaflet,\n    fillOpacity = 1,\n    fillColor = ~ pal_kbas(contain),\n    stroke = TRUE,\n    color = '#333333',\n    weight = ~ (triggered_by_birds * 2) + 0.5,\n    opacity = 1,\n    group = 'KBAs',\n    # label = ~ htmltools::htmlEscape(desig_eng),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      kbas_leaflet$int_name,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;a href=\"https://www.keybiodiversityareas.org/site/factsheet/',\n      kbas_leaflet$sit_rec_id,\n      '/assessment\", target=\"_blank\"&gt;Factsheet&lt;/a&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Groups: &lt;/b&gt;',\n      kbas_leaflet$contain,\n      '&lt;/br&gt;',\n      '&lt;b&gt;National site name: &lt;/b&gt;',\n      kbas_leaflet$nat_name,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Triggered by: &lt;/b&gt;',\n      kbas_leaflet$triggered_by,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Year of last assessment: &lt;/b&gt;',\n      kbas_leaflet$year\n    )\n  ) |&gt;\n\n  addPolygons(\n    data = raw_pa_data_pols,\n    weight = 0.5,\n    fillOpacity = 0.7,\n    fillColor = ~ pal(iucn_cat),\n    # stroke = FALSE,\n    color = '#333333',\n    opacity = 0.7,\n    group = 'Protected areas',\n    label = ~ htmltools::htmlEscape(desig_eng),\n    # label = ~ htmltools::htmlEscape(iucn_cat),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      raw_pa_data_pols$name_eng,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Designation: &lt;/b&gt;',\n      raw_pa_data_pols$desig_eng,\n      '&lt;/br&gt;',\n      '&lt;b&gt;IUCN category: &lt;/b&gt;',\n      raw_pa_data_pols$iucn_cat,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Realm: &lt;/b&gt;',\n      raw_pa_data_pols$realm,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Status (year): &lt;/b&gt;',\n      raw_pa_data_pols$status,\n      ' (',\n      raw_pa_data_pols$status_yr,\n      ')'\n    )\n  ) |&gt;\n  addLegend(\n    data = kbas_leaflet,\n    pal = pal_kbas,\n    values = levels(kbas_leaflet$contain),\n    opacity = 0.9,\n    group = 'KBAs',\n    title = 'KBAs'\n  ) |&gt;\n  addLegend(\n    data = raw_pa_data_pols,\n    pal = pal,\n    values = levels(raw_pa_data_pols$iucn_cat),\n    opacity = 0.9,\n    group = 'Protected areas',\n    title = \"Protected areas &lt;/br&gt; IUCN cats\"\n  ) |&gt;\n  addLayersControl(\n    baseGroups = c(\n      # \"Topography\",\n      \"Open Street Map\",\n      \"Satellite\"\n      \n      # \"Terrain\",\n    ),\n    overlayGroups = c(\n      'KBAs',\n      'Protected areas'\n    ),\n    options = layersControlOptions(collapsed = FALSE, position = \"bottomright\")\n  ) |&gt;\n  hideGroup(c('Protected areas')) |&gt;\n  addScaleBar(position = c(\"bottomleft\"), options = scaleBarOptions())",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Bangladesh</span>"
    ]
  },
  {
    "objectID": "bangladesh.html#first-stats-1",
    "href": "bangladesh.html#first-stats-1",
    "title": "Bangladesh",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nraw_pa_data_pols |&gt;\n  st_drop_geometry() |&gt; \n  count(desig_eng) |&gt; \n  filter(str_detect(desig_eng, 'UNESCO-MAB'))\n\n\n# A tibble: 0 × 2\n# ℹ 2 variables: desig_eng &lt;chr&gt;, n &lt;int&gt;\n\n\n\n\nCode\ng_labels &lt;- levels(raw_pa_data_pols$iucn_cat)[\n  length(levels(raw_pa_data_pols$iucn_cat)):1\n]\nn_desig &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  pull(desig_eng) |&gt;\n  unique() |&gt;\n  length()\npas_count &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  st_drop_geometry() |&gt;\n  count(iucn_cat, desig_eng, realm) |&gt;\n  mutate(iucn_cat = factor(iucn_cat, levels = g_labels))\n\npalette_desig &lt;- paletteer::paletteer_c(\"scico::roma\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"viridis::viridis\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"scico::batlow\", n = n_desig)\n\nggplotly(\n  pas_count |&gt;\n    arrange(iucn_cat) |&gt;\n    ggplot() +\n    aes(y = iucn_cat, x = n, fill = desig_eng) +\n    geom_col() +\n    labs(y = 'IUCN categories', x = 'Count') +\n    scale_fill_manual(\n      values = palette_desig,\n      # labels = \\(x) stringr::str_wrap(x, width = 32),\n      # 'Designation'\n    ) +\n    theme_minimal() +\n    theme(\n      legend.position = 'none',\n      plot.background = element_rect(fill = background_colour),\n      axis.title = element_text(family = 'worksans')\n    ) +\n    facet_wrap(~realm, scales = 'free')\n) \n\n\n\n\n\n\n\n\nCode\nselect(iucn_palette, -hex_colour)\n\n\n# A tibble: 10 × 2\n   id             cat                                                       \n   &lt;chr&gt;          &lt;chr&gt;                                                     \n 1 Ia             Ia Strict nature reserve                                  \n 2 Ib             Ib Wilderness area                                        \n 3 II             II National park                                          \n 4 III            III Natural monument or feature                           \n 5 IV             IV Habitat/species management area                        \n 6 V              V Protected landscape/seascape                            \n 7 VI             VI Protected area with sustainable use of natural resource\n 8 Not Applicable NA Not Applicable                                         \n 9 Not Assigned   NAS Not Assigned                                          \n10 Not Reported   NR Not Reported                                           \n\n\n\n\nCode\ncolours_desig &lt;- tibble(palette_desig, desig = sort(unique(pas_count$desig_eng)))\nprep &lt;- colours_desig |&gt;\n  select(colour = palette_desig, desig_eng = desig) |&gt; \n  right_join(pas_count)\n\nprep |&gt; \n  reactable(\n    showSortable = T,\n    defaultSorted = list(n = 'desc'),\n    searchable = TRUE,\n    defaultPageSize = 20,\n    showPageSizeOptions = TRUE,\n    pageSizeOptions = c(10, 20, 50, 100, nrow(pas_count)),\n    fullWidth = F,\n    columns = list(\n      colour = colDef(\n        sortable = F,\n        name = '',\n        maxWidth = 100,\n        style = function(value) {\n          colour &lt;- value\n          list(background = colour, color = colour)\n        }\n      ),\n      desig_eng = colDef(\n        name = 'Designation',\n        minWidth = 400\n      ),\n      realm = colDef(\n        name = 'Realm'\n      ),\n      iucn_cat = colDef(\n        name = 'IUCN (cat)',\n        minWidth = 150\n      ),\n      n = colDef(\n        name = 'Count'\n      )\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Bangladesh</span>"
    ]
  },
  {
    "objectID": "cambodia.html",
    "href": "cambodia.html",
    "title": "Cambodia",
    "section": "",
    "text": "Key Biodiversity Areas (KBAs)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Cambodia</span>"
    ]
  },
  {
    "objectID": "cambodia.html#first-stats",
    "href": "cambodia.html#first-stats",
    "title": "Cambodia",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nfile_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.shp$',\n  full.names = T\n)\n\ndf_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.xlsx$',\n  full.names = T\n)\n# readxl::excel_sheets(df_list)\n\nkbas_0 &lt;- lapply(file_list, read_sf) |&gt;\n  bind_rows() |&gt;\n  janitor::clean_names()\n\n\nkbas &lt;- kbas_0 |&gt;\n  filter(country == 'Cambodia')\n\n\ndf &lt;- readxl::read_xlsx(df_list) |&gt;\n  janitor::clean_names() |&gt;\n  filter(sit_rec_id %in% kbas$sit_rec_id)\n\n\nkbas_1 &lt;- kbas |&gt;\n  left_join(df) |&gt;\n  select(\n    sit_rec_id,\n    nat_name,\n    int_name,\n    kba_status,\n    ends_with('status'),\n    class,\n    taxon_id,\n    common_name,\n    scientific_name,\n    kba_criterias,\n    year\n  )\n\nkbas_2 &lt;- kbas_1 |&gt;\n  mutate(\n    class = str_to_title(class),\n    triggered_by_class = if_else(!is.na(kba_criterias), class, 'none'),\n    triggered_by_scinam = if_else(\n      !is.na(kba_criterias),\n      scientific_name,\n      'none'\n    )\n  )\n\nkba_3 &lt;- kbas_2 |&gt;\n  distinct(sit_rec_id, class, triggered_by_class, year) |&gt;\n  arrange(class) |&gt;\n  group_by(sit_rec_id) |&gt;\n  summarise(\n    class = paste0(class, collapse = ', '),\n    triggered_by = paste0(triggered_by_class, collapse = ', '),\n    triggered_by_birds = if_else(str_detect(triggered_by, 'Aves'), 1, 0),\n    year = unique(year)\n  ) |&gt;\n  mutate(\n    contain = case_when(\n      class == 'Aves' ~ 'Only birds',\n      str_detect(class, 'Aves') ~ 'Birds and others',\n      !str_detect(class, 'Aves') ~ 'No birds',\n\n      TRUE ~ 'check'\n    )\n  )\n\n\nkba_3$triggered_by &lt;- str_remove_all(kba_3$triggered_by, 'none|, ')\n\n# kba_3 |&gt;\n#   count(contain, triggered_by_birds)\n\nkbas_leaflet &lt;- kbas_2 |&gt;\n  mutate(\n    sci_name_class = paste0(scientific_name, ' (', class, ')'),\n    comm_name_class = paste0(common_name, ' (', class, ')')\n  ) |&gt;\n  arrange(class) |&gt;\n  # select(class, scientific_name, sci_name_class) |&gt;\n  group_by(sit_rec_id, int_name, nat_name, kba_status, year) |&gt;\n  summarise(\n    scientific_name = paste0(sci_name_class, collapse = ', '),\n    common_name = paste0(comm_name_class, collapse = ', ')\n  ) |&gt;\n  left_join(kba_3) |&gt;\n  ungroup() %&gt;%\n  filter(st_geometry_type(.) != 'POINT') |&gt;\n  st_cast('MULTIPOLYGON')\n\n\nkbas_leaflet_c &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  count(contain, triggered_by_birds, sort = T) |&gt;\n  mutate(contain = forcats::as_factor(contain), n = as.integer(n))\n\nn_kbas &lt;- length(unique(kbas_leaflet$sit_rec_id))\n\n\nn_kba_birds &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  filter(contain != 'No birds') |&gt;\n  nrow()\n\n\n# kbas_leaflet_c |&gt;\n#   ggplot() +\n#   aes(y = contain, x = n, fill = n) +\n#   geom_col() +\n#   theme_minimal()\nkbas_leaflet_c |&gt;\n  mutate(\n    triggered_by_birds = if_else(triggered_by_birds == '1', 'Yes', 'No'),\n    triggered_by_birds = factor(triggered_by_birds, levels = c('Yes', 'No'))\n  ) |&gt;\n  arrange(triggered_by_birds, contain) \n\n\n# A tibble: 4 × 3\n  contain          triggered_by_birds     n\n  &lt;fct&gt;            &lt;fct&gt;              &lt;int&gt;\n1 Birds and others Yes                    3\n2 Birds and others No                    25\n3 Only birds       No                    15\n4 No birds         No                     4\n\n\nCode\n  # ggplot() +\n  # aes(x = contain, y = n, fill = triggered_by_birds) +\n  # geom_col() +\n  # labs(x = NULL, y = 'Count') +\n\n  # scale_fill_manual('Triggered by birds?', values = c('#333333', '#d6d4cfff')) +\n  # # scale_fill_manual('Triggered by birds?', values = c('#7D804BFF', '#E6EEE0FF')) +\n  # theme_minimal() +\n  # theme(\n  #   legend.position = 'bottom',\n  #   plot.background = element_rect(fill = background_colour),\n  #   axis.title = element_text(family = 'worksans')\n  # )\n\n\n\n\n\n\n\n\n\n\nTotal number of KBAs\n\n\n\n47\n\n\n\n\n\n\n\n\n\n\nNumber of KBAs with Birds\n\n\n\n43\n\n\n\n\n\n\nCode\n# glimpse(raw_pa_data)\n# st_geometry_type(raw_pa_data) == 'MULTIPOLYGON'\nraw_pa_data_pols &lt;- raw_pa_data |&gt;\n  filter(st_geometry_type(raw_pa_data) == 'MULTIPOLYGON') |&gt;\n  mutate(\n    iucn_cat = factor(\n      iucn_cat,\n      levels = c(\n        'Ia',\n        'Ib',\n        'II',\n        'III',\n        'IV',\n        'V',\n        'VI',\n        'Not Applicable',\n        'Not Reported',\n        'Not Assigned'\n      )\n    ),\n    realm = factor(realm, levels = c('Coastal', 'Marine', 'Terrestrial'))\n  )\n\n# raw_pa_data_pols$iucn_cat\n# raw_pa_data |&gt;\n#   st_drop_geometry() |&gt;\n#   count(status)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Cambodia</span>"
    ]
  },
  {
    "objectID": "cambodia.html#kbas-map",
    "href": "cambodia.html#kbas-map",
    "title": "Cambodia",
    "section": "KBAs map",
    "text": "KBAs map\n\n\nCode\n# kbas_leaflet$contain |&gt; unique() |&gt; sort()\n\nkbas_leaflet &lt;- kbas_leaflet |&gt;\n  arrange(contain) |&gt;\n  mutate(contain = forcats::as_factor(contain))\n\n\npal_kbas &lt;- colorFactor(\n  domain = levels(kbas_leaflet$contain),\n  palette = c('#2e6ba6', '#e53d3d', '#59de9e')\n)\n\niucn_palette &lt;- tribble(\n  ~id, ~cat, ~hex_colour,\n  'Ia', 'Ia Strict nature reserve', '#174721', \n  'Ib', 'Ib Wilderness area', '#7AC141',\n  'II', 'II National park', '#5D873B',\n  'III', 'III Natural monument or feature', '#AFBD36',\n  'IV', 'IV Habitat/species management area', '#C8DF8D',\n  'V', 'V Protected landscape/seascape', '#15477C',\n  'VI', 'VI Protected area with sustainable use of natural resource', '#7EA1B5',\n  'Not Applicable', 'NA Not Applicable', '#894444',\n  'Not Assigned', 'NAS Not Assigned', '#E60000',\n  'Not Reported', 'NR Not Reported', '#898944'\n)\n\niucn_palette &lt;- iucn_palette |&gt; \n  filter(id %in% levels(raw_pa_data_pols$iucn_cat))\n\npal &lt;- colorFactor(\n  domain = levels(raw_pa_data_pols$iucn_cat),\n  palette = iucn_palette$hex_colour\n)\n# pal &lt;- colorFactor(\n#   domain = levels(raw_pa_data_pols$iucn_cat),\n#   c(\n#     '#232021',\n#     '#426f41',\n#     '#59ba49',\n#     '#c1178d',\n#     '#feb016',\n#     '#e61e24'\n#   )\n# )\n\nbasemap_leaflet |&gt;\n  addPolygons(\n    data = kbas_leaflet,\n    fillOpacity = 1,\n    fillColor = ~ pal_kbas(contain),\n    stroke = TRUE,\n    color = '#333333',\n    weight = ~ (triggered_by_birds * 2) + 0.5,\n    opacity = 1,\n    group = 'KBAs',\n    # label = ~ htmltools::htmlEscape(desig_eng),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      kbas_leaflet$int_name,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;a href=\"https://www.keybiodiversityareas.org/site/factsheet/',\n      kbas_leaflet$sit_rec_id,\n      '/assessment\", target=\"_blank\"&gt;Factsheet&lt;/a&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Groups: &lt;/b&gt;',\n      kbas_leaflet$contain,\n      '&lt;/br&gt;',\n      '&lt;b&gt;National site name: &lt;/b&gt;',\n      kbas_leaflet$nat_name,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Triggered by: &lt;/b&gt;',\n      kbas_leaflet$triggered_by,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Year of last assessment: &lt;/b&gt;',\n      kbas_leaflet$year\n    )\n  ) |&gt;\n\n  addPolygons(\n    data = raw_pa_data_pols,\n    weight = 0.5,\n    fillOpacity = 0.7,\n    fillColor = ~ pal(iucn_cat),\n    # stroke = FALSE,\n    color = '#333333',\n    opacity = 0.7,\n    group = 'Protected areas',\n    label = ~ htmltools::htmlEscape(desig_eng),\n    # label = ~ htmltools::htmlEscape(iucn_cat),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      raw_pa_data_pols$name_eng,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Designation: &lt;/b&gt;',\n      raw_pa_data_pols$desig_eng,\n      '&lt;/br&gt;',\n      '&lt;b&gt;IUCN category: &lt;/b&gt;',\n      raw_pa_data_pols$iucn_cat,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Realm: &lt;/b&gt;',\n      raw_pa_data_pols$realm,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Status (year): &lt;/b&gt;',\n      raw_pa_data_pols$status,\n      ' (',\n      raw_pa_data_pols$status_yr,\n      ')'\n    )\n  ) |&gt;\n  addLegend(\n    data = kbas_leaflet,\n    pal = pal_kbas,\n    values = levels(kbas_leaflet$contain),\n    opacity = 0.9,\n    group = 'KBAs',\n    title = 'KBAs'\n  ) |&gt;\n  addLegend(\n    data = raw_pa_data_pols,\n    pal = pal,\n    values = levels(raw_pa_data_pols$iucn_cat),\n    opacity = 0.9,\n    group = 'Protected areas',\n    title = \"Protected areas &lt;/br&gt; IUCN cats\"\n  ) |&gt;\n  addLayersControl(\n    baseGroups = c(\n      # \"Topography\",\n      \"Open Street Map\",\n      \"Satellite\"\n      \n      # \"Terrain\",\n    ),\n    overlayGroups = c(\n      'KBAs',\n      'Protected areas'\n    ),\n    options = layersControlOptions(collapsed = FALSE, position = \"bottomright\")\n  ) |&gt;\n  hideGroup(c('Protected areas')) |&gt;\n  addScaleBar(position = c(\"bottomleft\"), options = scaleBarOptions())",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Cambodia</span>"
    ]
  },
  {
    "objectID": "cambodia.html#first-stats-1",
    "href": "cambodia.html#first-stats-1",
    "title": "Cambodia",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nraw_pa_data_pols |&gt;\n  st_drop_geometry() |&gt; \n  count(desig_eng) |&gt; \n  filter(str_detect(desig_eng, 'UNESCO-MAB'))\n\n\n# A tibble: 0 × 2\n# ℹ 2 variables: desig_eng &lt;chr&gt;, n &lt;int&gt;\n\n\n\n\nCode\ng_labels &lt;- levels(raw_pa_data_pols$iucn_cat)[\n  length(levels(raw_pa_data_pols$iucn_cat)):1\n]\nn_desig &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  pull(desig_eng) |&gt;\n  unique() |&gt;\n  length()\npas_count &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  st_drop_geometry() |&gt;\n  count(iucn_cat, desig_eng, realm) |&gt;\n  mutate(iucn_cat = factor(iucn_cat, levels = g_labels))\n\npalette_desig &lt;- paletteer::paletteer_c(\"scico::roma\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"viridis::viridis\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"scico::batlow\", n = n_desig)\n\nggplotly(\n  pas_count |&gt;\n    arrange(iucn_cat) |&gt;\n    ggplot() +\n    aes(y = iucn_cat, x = n, fill = desig_eng) +\n    geom_col() +\n    labs(y = 'IUCN categories', x = 'Count') +\n    scale_fill_manual(\n      values = palette_desig,\n      # labels = \\(x) stringr::str_wrap(x, width = 32),\n      # 'Designation'\n    ) +\n    theme_minimal() +\n    theme(\n      legend.position = 'none',\n      plot.background = element_rect(fill = background_colour),\n      axis.title = element_text(family = 'worksans')\n    ) +\n    facet_wrap(~realm, scales = 'free')\n) \n\n\n\n\n\n\n\n\nCode\nselect(iucn_palette, -hex_colour)\n\n\n# A tibble: 10 × 2\n   id             cat                                                       \n   &lt;chr&gt;          &lt;chr&gt;                                                     \n 1 Ia             Ia Strict nature reserve                                  \n 2 Ib             Ib Wilderness area                                        \n 3 II             II National park                                          \n 4 III            III Natural monument or feature                           \n 5 IV             IV Habitat/species management area                        \n 6 V              V Protected landscape/seascape                            \n 7 VI             VI Protected area with sustainable use of natural resource\n 8 Not Applicable NA Not Applicable                                         \n 9 Not Assigned   NAS Not Assigned                                          \n10 Not Reported   NR Not Reported                                           \n\n\n\n\nCode\ncolours_desig &lt;- tibble(palette_desig, desig = sort(unique(pas_count$desig_eng)))\nprep &lt;- colours_desig |&gt;\n  select(colour = palette_desig, desig_eng = desig) |&gt; \n  right_join(pas_count)\n\nprep |&gt; \n  reactable(\n    showSortable = T,\n    defaultSorted = list(n = 'desc'),\n    searchable = TRUE,\n    defaultPageSize = 20,\n    showPageSizeOptions = TRUE,\n    pageSizeOptions = c(10, 20, 50, 100, nrow(pas_count)),\n    fullWidth = F,\n    columns = list(\n      colour = colDef(\n        sortable = F,\n        name = '',\n        maxWidth = 100,\n        style = function(value) {\n          colour &lt;- value\n          list(background = colour, color = colour)\n        }\n      ),\n      desig_eng = colDef(\n        name = 'Designation',\n        minWidth = 400\n      ),\n      realm = colDef(\n        name = 'Realm'\n      ),\n      iucn_cat = colDef(\n        name = 'IUCN (cat)',\n        minWidth = 150\n      ),\n      n = colDef(\n        name = 'Count'\n      )\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Cambodia</span>"
    ]
  },
  {
    "objectID": "ecuador.html",
    "href": "ecuador.html",
    "title": "Ecuador",
    "section": "",
    "text": "Key Biodiversity Areas (KBAs)",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Ecuador</span>"
    ]
  },
  {
    "objectID": "ecuador.html#first-stats",
    "href": "ecuador.html#first-stats",
    "title": "Ecuador",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nfile_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.shp$',\n  full.names = T\n)\n\ndf_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.xlsx$',\n  full.names = T\n)\n# readxl::excel_sheets(df_list)\n\nkbas_0 &lt;- lapply(file_list, read_sf) |&gt;\n  bind_rows() |&gt;\n  janitor::clean_names()\n\n\nkbas &lt;- kbas_0 |&gt;\n  filter(country == 'Ecuador')\n\n\ndf &lt;- readxl::read_xlsx(df_list) |&gt;\n  janitor::clean_names() |&gt;\n  filter(sit_rec_id %in% kbas$sit_rec_id)\n\n\nkbas_1 &lt;- kbas |&gt;\n  left_join(df) |&gt;\n  select(\n    sit_rec_id,\n    nat_name,\n    int_name,\n    kba_status,\n    ends_with('status'),\n    class,\n    taxon_id,\n    common_name,\n    scientific_name,\n    kba_criterias,\n    year\n  )\n\nkbas_2 &lt;- kbas_1 |&gt;\n  mutate(\n    class = str_to_title(class),\n    triggered_by_class = if_else(!is.na(kba_criterias), class, 'none'),\n    triggered_by_scinam = if_else(\n      !is.na(kba_criterias),\n      scientific_name,\n      'none'\n    )\n  )\n\nkba_3 &lt;- kbas_2 |&gt;\n  distinct(sit_rec_id, class, triggered_by_class, year) |&gt;\n  arrange(class) |&gt;\n  group_by(sit_rec_id) |&gt;\n  summarise(\n    class = paste0(class, collapse = ', '),\n    triggered_by = paste0(triggered_by_class, collapse = ', '),\n    triggered_by_birds = if_else(str_detect(triggered_by, 'Aves'), 1, 0),\n    year = unique(year)\n  ) |&gt;\n  mutate(\n    contain = case_when(\n      class == 'Aves' ~ 'Only birds',\n      str_detect(class, 'Aves') ~ 'Birds and others',\n      !str_detect(class, 'Aves') ~ 'No birds',\n\n      TRUE ~ 'check'\n    )\n  )\n\n\nkba_3$triggered_by &lt;- str_remove_all(kba_3$triggered_by, 'none|, ')\n\n# kba_3 |&gt;\n#   count(contain, triggered_by_birds)\n\nkbas_leaflet &lt;- kbas_2 |&gt;\n  mutate(\n    sci_name_class = paste0(scientific_name, ' (', class, ')'),\n    comm_name_class = paste0(common_name, ' (', class, ')')\n  ) |&gt;\n  arrange(class) |&gt;\n  # select(class, scientific_name, sci_name_class) |&gt;\n  group_by(sit_rec_id, int_name, nat_name, kba_status, year) |&gt;\n  summarise(\n    scientific_name = paste0(sci_name_class, collapse = ', '),\n    common_name = paste0(comm_name_class, collapse = ', ')\n  ) |&gt;\n  left_join(kba_3) |&gt;\n  ungroup() %&gt;%\n  filter(st_geometry_type(.) != 'POINT') |&gt;\n  st_cast('MULTIPOLYGON')\n\n\nkbas_leaflet_c &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  count(contain, triggered_by_birds, sort = T) |&gt;\n  mutate(contain = forcats::as_factor(contain), n = as.integer(n))\n\nn_kbas &lt;- length(unique(kbas_leaflet$sit_rec_id))\n\n\nn_kba_birds &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  filter(contain != 'No birds') |&gt;\n  nrow()\n\n\n# kbas_leaflet_c |&gt;\n#   ggplot() +\n#   aes(y = contain, x = n, fill = n) +\n#   geom_col() +\n#   theme_minimal()\nkbas_leaflet_c |&gt;\n  mutate(\n    triggered_by_birds = if_else(triggered_by_birds == '1', 'Yes', 'No'),\n    triggered_by_birds = factor(triggered_by_birds, levels = c('Yes', 'No'))\n  ) |&gt;\n  arrange(triggered_by_birds, contain) \n\n\n# A tibble: 4 × 3\n  contain          triggered_by_birds     n\n  &lt;fct&gt;            &lt;fct&gt;              &lt;int&gt;\n1 Birds and others Yes                   80\n2 Only birds       Yes                   17\n3 Birds and others No                     1\n4 No birds         No                    26\n\n\nCode\n  # ggplot() +\n  # aes(x = contain, y = n, fill = triggered_by_birds) +\n  # geom_col() +\n  # labs(x = NULL, y = 'Count') +\n\n  # scale_fill_manual('Triggered by birds?', values = c('#333333', '#d6d4cfff')) +\n  # # scale_fill_manual('Triggered by birds?', values = c('#7D804BFF', '#E6EEE0FF')) +\n  # theme_minimal() +\n  # theme(\n  #   legend.position = 'bottom',\n  #   plot.background = element_rect(fill = background_colour),\n  #   axis.title = element_text(family = 'worksans')\n  # )\n\n\n\n\n\n\n\n\n\n\nTotal number of KBAs\n\n\n\n124\n\n\n\n\n\n\n\n\n\n\nNumber of KBAs with Birds\n\n\n\n98\n\n\n\n\n\n\nCode\n# glimpse(raw_pa_data)\n# st_geometry_type(raw_pa_data) == 'MULTIPOLYGON'\nraw_pa_data_pols &lt;- raw_pa_data |&gt;\n  filter(st_geometry_type(raw_pa_data) == 'MULTIPOLYGON') |&gt;\n  mutate(\n    iucn_cat = factor(\n      iucn_cat,\n      levels = c(\n        'Ia',\n        'Ib',\n        'II',\n        'III',\n        'IV',\n        'V',\n        'VI',\n        'Not Applicable',\n        'Not Reported',\n        'Not Assigned'\n      )\n    ),\n    realm = factor(realm, levels = c('Coastal', 'Marine', 'Terrestrial'))\n  )\n\n# raw_pa_data_pols$iucn_cat\n# raw_pa_data |&gt;\n#   st_drop_geometry() |&gt;\n#   count(status)",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Ecuador</span>"
    ]
  },
  {
    "objectID": "ecuador.html#kbas-map",
    "href": "ecuador.html#kbas-map",
    "title": "Ecuador",
    "section": "KBAs map",
    "text": "KBAs map\n\n\nCode\n# kbas_leaflet$contain |&gt; unique() |&gt; sort()\n\nkbas_leaflet &lt;- kbas_leaflet |&gt;\n  arrange(contain) |&gt;\n  mutate(contain = forcats::as_factor(contain))\n\n\npal_kbas &lt;- colorFactor(\n  domain = levels(kbas_leaflet$contain),\n  palette = c('#2e6ba6', '#e53d3d', '#59de9e')\n)\n\niucn_palette &lt;- tribble(\n  ~id, ~cat, ~hex_colour,\n  'Ia', 'Ia Strict nature reserve', '#174721', \n  'Ib', 'Ib Wilderness area', '#7AC141',\n  'II', 'II National park', '#5D873B',\n  'III', 'III Natural monument or feature', '#AFBD36',\n  'IV', 'IV Habitat/species management area', '#C8DF8D',\n  'V', 'V Protected landscape/seascape', '#15477C',\n  'VI', 'VI Protected area with sustainable use of natural resource', '#7EA1B5',\n  'Not Applicable', 'NA Not Applicable', '#894444',\n  'Not Assigned', 'NAS Not Assigned', '#E60000',\n  'Not Reported', 'NR Not Reported', '#898944'\n)\n\niucn_palette &lt;- iucn_palette |&gt; \n  filter(id %in% levels(raw_pa_data_pols$iucn_cat))\n\npal &lt;- colorFactor(\n  domain = levels(raw_pa_data_pols$iucn_cat),\n  palette = iucn_palette$hex_colour\n)\n# pal &lt;- colorFactor(\n#   domain = levels(raw_pa_data_pols$iucn_cat),\n#   c(\n#     '#232021',\n#     '#426f41',\n#     '#59ba49',\n#     '#c1178d',\n#     '#feb016',\n#     '#e61e24'\n#   )\n# )\n\nbasemap_leaflet |&gt;\n  addPolygons(\n    data = kbas_leaflet,\n    fillOpacity = 1,\n    fillColor = ~ pal_kbas(contain),\n    stroke = TRUE,\n    color = '#333333',\n    weight = ~ (triggered_by_birds * 2) + 0.5,\n    opacity = 1,\n    group = 'KBAs',\n    # label = ~ htmltools::htmlEscape(desig_eng),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      kbas_leaflet$int_name,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;a href=\"https://www.keybiodiversityareas.org/site/factsheet/',\n      kbas_leaflet$sit_rec_id,\n      '/assessment\", target=\"_blank\"&gt;Factsheet&lt;/a&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Groups: &lt;/b&gt;',\n      kbas_leaflet$contain,\n      '&lt;/br&gt;',\n      '&lt;b&gt;National site name: &lt;/b&gt;',\n      kbas_leaflet$nat_name,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Triggered by: &lt;/b&gt;',\n      kbas_leaflet$triggered_by,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Year of last assessment: &lt;/b&gt;',\n      kbas_leaflet$year\n    )\n  ) |&gt;\n\n  addPolygons(\n    data = raw_pa_data_pols,\n    weight = 0.5,\n    fillOpacity = 0.7,\n    fillColor = ~ pal(iucn_cat),\n    # stroke = FALSE,\n    color = '#333333',\n    opacity = 0.7,\n    group = 'Protected areas',\n    label = ~ htmltools::htmlEscape(desig_eng),\n    # label = ~ htmltools::htmlEscape(iucn_cat),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      raw_pa_data_pols$name_eng,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Designation: &lt;/b&gt;',\n      raw_pa_data_pols$desig_eng,\n      '&lt;/br&gt;',\n      '&lt;b&gt;IUCN category: &lt;/b&gt;',\n      raw_pa_data_pols$iucn_cat,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Realm: &lt;/b&gt;',\n      raw_pa_data_pols$realm,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Status (year): &lt;/b&gt;',\n      raw_pa_data_pols$status,\n      ' (',\n      raw_pa_data_pols$status_yr,\n      ')'\n    )\n  ) |&gt;\n  addLegend(\n    data = kbas_leaflet,\n    pal = pal_kbas,\n    values = levels(kbas_leaflet$contain),\n    opacity = 0.9,\n    group = 'KBAs',\n    title = 'KBAs'\n  ) |&gt;\n  addLegend(\n    data = raw_pa_data_pols,\n    pal = pal,\n    values = levels(raw_pa_data_pols$iucn_cat),\n    opacity = 0.9,\n    group = 'Protected areas',\n    title = \"Protected areas &lt;/br&gt; IUCN cats\"\n  ) |&gt;\n  addLayersControl(\n    baseGroups = c(\n      # \"Topography\",\n      \"Open Street Map\",\n      \"Satellite\"\n      \n      # \"Terrain\",\n    ),\n    overlayGroups = c(\n      'KBAs',\n      'Protected areas'\n    ),\n    options = layersControlOptions(collapsed = FALSE, position = \"bottomright\")\n  ) |&gt;\n  hideGroup(c('Protected areas')) |&gt;\n  addScaleBar(position = c(\"bottomleft\"), options = scaleBarOptions())",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Ecuador</span>"
    ]
  },
  {
    "objectID": "ecuador.html#first-stats-1",
    "href": "ecuador.html#first-stats-1",
    "title": "Ecuador",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nraw_pa_data_pols |&gt;\n  st_drop_geometry() |&gt; \n  count(desig_eng) |&gt; \n  filter(str_detect(desig_eng, 'UNESCO-MAB'))\n\n\n# A tibble: 1 × 2\n  desig_eng                        n\n  &lt;chr&gt;                        &lt;int&gt;\n1 UNESCO-MAB Biosphere Reserve     1\n\n\n\n\nCode\ng_labels &lt;- levels(raw_pa_data_pols$iucn_cat)[\n  length(levels(raw_pa_data_pols$iucn_cat)):1\n]\nn_desig &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  pull(desig_eng) |&gt;\n  unique() |&gt;\n  length()\npas_count &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  st_drop_geometry() |&gt;\n  count(iucn_cat, desig_eng, realm) |&gt;\n  mutate(iucn_cat = factor(iucn_cat, levels = g_labels))\n\npalette_desig &lt;- paletteer::paletteer_c(\"scico::roma\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"viridis::viridis\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"scico::batlow\", n = n_desig)\n\nggplotly(\n  pas_count |&gt;\n    arrange(iucn_cat) |&gt;\n    ggplot() +\n    aes(y = iucn_cat, x = n, fill = desig_eng) +\n    geom_col() +\n    labs(y = 'IUCN categories', x = 'Count') +\n    scale_fill_manual(\n      values = palette_desig,\n      # labels = \\(x) stringr::str_wrap(x, width = 32),\n      # 'Designation'\n    ) +\n    theme_minimal() +\n    theme(\n      legend.position = 'none',\n      plot.background = element_rect(fill = background_colour),\n      axis.title = element_text(family = 'worksans')\n    ) +\n    facet_wrap(~realm, scales = 'free')\n) \n\n\n\n\n\n\n\n\nCode\nselect(iucn_palette, -hex_colour)\n\n\n# A tibble: 10 × 2\n   id             cat                                                       \n   &lt;chr&gt;          &lt;chr&gt;                                                     \n 1 Ia             Ia Strict nature reserve                                  \n 2 Ib             Ib Wilderness area                                        \n 3 II             II National park                                          \n 4 III            III Natural monument or feature                           \n 5 IV             IV Habitat/species management area                        \n 6 V              V Protected landscape/seascape                            \n 7 VI             VI Protected area with sustainable use of natural resource\n 8 Not Applicable NA Not Applicable                                         \n 9 Not Assigned   NAS Not Assigned                                          \n10 Not Reported   NR Not Reported                                           \n\n\n\n\nCode\ncolours_desig &lt;- tibble(palette_desig, desig = sort(unique(pas_count$desig_eng)))\nprep &lt;- colours_desig |&gt;\n  select(colour = palette_desig, desig_eng = desig) |&gt; \n  right_join(pas_count)\n\nprep |&gt; \n  reactable(\n    showSortable = T,\n    defaultSorted = list(n = 'desc'),\n    searchable = TRUE,\n    defaultPageSize = 20,\n    showPageSizeOptions = TRUE,\n    pageSizeOptions = c(10, 20, 50, 100, nrow(pas_count)),\n    fullWidth = F,\n    columns = list(\n      colour = colDef(\n        sortable = F,\n        name = '',\n        maxWidth = 100,\n        style = function(value) {\n          colour &lt;- value\n          list(background = colour, color = colour)\n        }\n      ),\n      desig_eng = colDef(\n        name = 'Designation',\n        minWidth = 400\n      ),\n      realm = colDef(\n        name = 'Realm'\n      ),\n      iucn_cat = colDef(\n        name = 'IUCN (cat)',\n        minWidth = 150\n      ),\n      n = colDef(\n        name = 'Count'\n      )\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Ecuador</span>"
    ]
  },
  {
    "objectID": "kazakhstan.html",
    "href": "kazakhstan.html",
    "title": "Kazakhstan",
    "section": "",
    "text": "Key Biodiversity Areas (KBAs)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Kazakhstan</span>"
    ]
  },
  {
    "objectID": "kazakhstan.html#first-stats",
    "href": "kazakhstan.html#first-stats",
    "title": "Kazakhstan",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nfile_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.shp$',\n  full.names = T\n)\n\ndf_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.xlsx$',\n  full.names = T\n)\n# readxl::excel_sheets(df_list)\n\nkbas_0 &lt;- lapply(file_list, read_sf) |&gt;\n  bind_rows() |&gt;\n  janitor::clean_names()\n\n\nkbas &lt;- kbas_0 |&gt;\n  filter(country == 'Kazakhstan')\n\n\ndf &lt;- readxl::read_xlsx(df_list) |&gt;\n  janitor::clean_names() |&gt;\n  filter(sit_rec_id %in% kbas$sit_rec_id)\n\n\nkbas_1 &lt;- kbas |&gt;\n  left_join(df) |&gt;\n  select(\n    sit_rec_id,\n    nat_name,\n    int_name,\n    kba_status,\n    ends_with('status'),\n    class,\n    taxon_id,\n    common_name,\n    scientific_name,\n    kba_criterias,\n    year\n  )\n\nkbas_2 &lt;- kbas_1 |&gt;\n  mutate(\n    class = str_to_title(class),\n    triggered_by_class = if_else(!is.na(kba_criterias), class, 'none'),\n    triggered_by_scinam = if_else(\n      !is.na(kba_criterias),\n      scientific_name,\n      'none'\n    )\n  )\n\nkba_3 &lt;- kbas_2 |&gt;\n  distinct(sit_rec_id, class, triggered_by_class, year) |&gt;\n  arrange(class) |&gt;\n  group_by(sit_rec_id) |&gt;\n  summarise(\n    class = paste0(class, collapse = ', '),\n    triggered_by = paste0(triggered_by_class, collapse = ', '),\n    triggered_by_birds = if_else(str_detect(triggered_by, 'Aves'), 1, 0),\n    year = unique(year)\n  ) |&gt;\n  mutate(\n    contain = case_when(\n      class == 'Aves' ~ 'Only birds',\n      str_detect(class, 'Aves') ~ 'Birds and others',\n      !str_detect(class, 'Aves') ~ 'No birds',\n\n      TRUE ~ 'check'\n    )\n  )\n\n\nkba_3$triggered_by &lt;- str_remove_all(kba_3$triggered_by, 'none|, ')\n\n# kba_3 |&gt;\n#   count(contain, triggered_by_birds)\n\nkbas_leaflet &lt;- kbas_2 |&gt;\n  mutate(\n    sci_name_class = paste0(scientific_name, ' (', class, ')'),\n    comm_name_class = paste0(common_name, ' (', class, ')')\n  ) |&gt;\n  arrange(class) |&gt;\n  # select(class, scientific_name, sci_name_class) |&gt;\n  group_by(sit_rec_id, int_name, nat_name, kba_status, year) |&gt;\n  summarise(\n    scientific_name = paste0(sci_name_class, collapse = ', '),\n    common_name = paste0(comm_name_class, collapse = ', ')\n  ) |&gt;\n  left_join(kba_3) |&gt;\n  ungroup() %&gt;%\n  filter(st_geometry_type(.) != 'POINT') |&gt;\n  st_cast('MULTIPOLYGON')\n\n\nkbas_leaflet_c &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  count(contain, triggered_by_birds, sort = T) |&gt;\n  mutate(contain = forcats::as_factor(contain), n = as.integer(n))\n\nn_kbas &lt;- length(unique(kbas_leaflet$sit_rec_id))\n\n\nn_kba_birds &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  filter(contain != 'No birds') |&gt;\n  nrow()\n\n\n# kbas_leaflet_c |&gt;\n#   ggplot() +\n#   aes(y = contain, x = n, fill = n) +\n#   geom_col() +\n#   theme_minimal()\nkbas_leaflet_c |&gt;\n  mutate(\n    triggered_by_birds = if_else(triggered_by_birds == '1', 'Yes', 'No'),\n    triggered_by_birds = factor(triggered_by_birds, levels = c('Yes', 'No'))\n  ) |&gt;\n  arrange(triggered_by_birds, contain) \n\n\n# A tibble: 5 × 3\n  contain          triggered_by_birds     n\n  &lt;fct&gt;            &lt;fct&gt;              &lt;int&gt;\n1 Birds and others Yes                   66\n2 Only birds       Yes                    8\n3 Birds and others No                     1\n4 Only birds       No                    46\n5 No birds         No                     5\n\n\nCode\n  # ggplot() +\n  # aes(x = contain, y = n, fill = triggered_by_birds) +\n  # geom_col() +\n  # labs(x = NULL, y = 'Count') +\n\n  # scale_fill_manual('Triggered by birds?', values = c('#333333', '#d6d4cfff')) +\n  # # scale_fill_manual('Triggered by birds?', values = c('#7D804BFF', '#E6EEE0FF')) +\n  # theme_minimal() +\n  # theme(\n  #   legend.position = 'bottom',\n  #   plot.background = element_rect(fill = background_colour),\n  #   axis.title = element_text(family = 'worksans')\n  # )\n\n\n\n\n\n\n\n\n\n\nTotal number of KBAs\n\n\n\n126\n\n\n\n\n\n\n\n\n\n\nNumber of KBAs with Birds\n\n\n\n121\n\n\n\n\n\n\nCode\n# glimpse(raw_pa_data)\n# st_geometry_type(raw_pa_data) == 'MULTIPOLYGON'\nraw_pa_data_pols &lt;- raw_pa_data |&gt;\n  filter(st_geometry_type(raw_pa_data) == 'MULTIPOLYGON') |&gt;\n  mutate(\n    iucn_cat = factor(\n      iucn_cat,\n      levels = c(\n        'Ia',\n        'Ib',\n        'II',\n        'III',\n        'IV',\n        'V',\n        'VI',\n        'Not Applicable',\n        'Not Reported',\n        'Not Assigned'\n      )\n    ),\n    realm = factor(realm, levels = c('Coastal', 'Marine', 'Terrestrial'))\n  )\n\n# raw_pa_data_pols$iucn_cat\n# raw_pa_data |&gt;\n#   st_drop_geometry() |&gt;\n#   count(status)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Kazakhstan</span>"
    ]
  },
  {
    "objectID": "kazakhstan.html#kbas-map",
    "href": "kazakhstan.html#kbas-map",
    "title": "Kazakhstan",
    "section": "KBAs map",
    "text": "KBAs map\n\n\nCode\n# kbas_leaflet$contain |&gt; unique() |&gt; sort()\n\nkbas_leaflet &lt;- kbas_leaflet |&gt;\n  arrange(contain) |&gt;\n  mutate(contain = forcats::as_factor(contain))\n\n\npal_kbas &lt;- colorFactor(\n  domain = levels(kbas_leaflet$contain),\n  palette = c('#2e6ba6', '#e53d3d', '#59de9e')\n)\n\niucn_palette &lt;- tribble(\n  ~id, ~cat, ~hex_colour,\n  'Ia', 'Ia Strict nature reserve', '#174721', \n  'Ib', 'Ib Wilderness area', '#7AC141',\n  'II', 'II National park', '#5D873B',\n  'III', 'III Natural monument or feature', '#AFBD36',\n  'IV', 'IV Habitat/species management area', '#C8DF8D',\n  'V', 'V Protected landscape/seascape', '#15477C',\n  'VI', 'VI Protected area with sustainable use of natural resource', '#7EA1B5',\n  'Not Applicable', 'NA Not Applicable', '#894444',\n  'Not Assigned', 'NAS Not Assigned', '#E60000',\n  'Not Reported', 'NR Not Reported', '#898944'\n)\n\niucn_palette &lt;- iucn_palette |&gt; \n  filter(id %in% levels(raw_pa_data_pols$iucn_cat))\n\npal &lt;- colorFactor(\n  domain = levels(raw_pa_data_pols$iucn_cat),\n  palette = iucn_palette$hex_colour\n)\n# pal &lt;- colorFactor(\n#   domain = levels(raw_pa_data_pols$iucn_cat),\n#   c(\n#     '#232021',\n#     '#426f41',\n#     '#59ba49',\n#     '#c1178d',\n#     '#feb016',\n#     '#e61e24'\n#   )\n# )\n\nbasemap_leaflet |&gt;\n  addPolygons(\n    data = kbas_leaflet,\n    fillOpacity = 1,\n    fillColor = ~ pal_kbas(contain),\n    stroke = TRUE,\n    color = '#333333',\n    weight = ~ (triggered_by_birds * 2) + 0.5,\n    opacity = 1,\n    group = 'KBAs',\n    # label = ~ htmltools::htmlEscape(desig_eng),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      kbas_leaflet$int_name,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;a href=\"https://www.keybiodiversityareas.org/site/factsheet/',\n      kbas_leaflet$sit_rec_id,\n      '/assessment\", target=\"_blank\"&gt;Factsheet&lt;/a&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Groups: &lt;/b&gt;',\n      kbas_leaflet$contain,\n      '&lt;/br&gt;',\n      '&lt;b&gt;National site name: &lt;/b&gt;',\n      kbas_leaflet$nat_name,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Triggered by: &lt;/b&gt;',\n      kbas_leaflet$triggered_by,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Year of last assessment: &lt;/b&gt;',\n      kbas_leaflet$year\n    )\n  ) |&gt;\n\n  addPolygons(\n    data = raw_pa_data_pols,\n    weight = 0.5,\n    fillOpacity = 0.7,\n    fillColor = ~ pal(iucn_cat),\n    # stroke = FALSE,\n    color = '#333333',\n    opacity = 0.7,\n    group = 'Protected areas',\n    label = ~ htmltools::htmlEscape(desig_eng),\n    # label = ~ htmltools::htmlEscape(iucn_cat),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      raw_pa_data_pols$name_eng,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Designation: &lt;/b&gt;',\n      raw_pa_data_pols$desig_eng,\n      '&lt;/br&gt;',\n      '&lt;b&gt;IUCN category: &lt;/b&gt;',\n      raw_pa_data_pols$iucn_cat,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Realm: &lt;/b&gt;',\n      raw_pa_data_pols$realm,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Status (year): &lt;/b&gt;',\n      raw_pa_data_pols$status,\n      ' (',\n      raw_pa_data_pols$status_yr,\n      ')'\n    )\n  ) |&gt;\n  addLegend(\n    data = kbas_leaflet,\n    pal = pal_kbas,\n    values = levels(kbas_leaflet$contain),\n    opacity = 0.9,\n    group = 'KBAs',\n    title = 'KBAs'\n  ) |&gt;\n  addLegend(\n    data = raw_pa_data_pols,\n    pal = pal,\n    values = levels(raw_pa_data_pols$iucn_cat),\n    opacity = 0.9,\n    group = 'Protected areas',\n    title = \"Protected areas &lt;/br&gt; IUCN cats\"\n  ) |&gt;\n  addLayersControl(\n    baseGroups = c(\n      # \"Topography\",\n      \"Open Street Map\",\n      \"Satellite\"\n      \n      # \"Terrain\",\n    ),\n    overlayGroups = c(\n      'KBAs',\n      'Protected areas'\n    ),\n    options = layersControlOptions(collapsed = FALSE, position = \"bottomright\")\n  ) |&gt;\n  hideGroup(c('Protected areas')) |&gt;\n  addScaleBar(position = c(\"bottomleft\"), options = scaleBarOptions())",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Kazakhstan</span>"
    ]
  },
  {
    "objectID": "kazakhstan.html#first-stats-1",
    "href": "kazakhstan.html#first-stats-1",
    "title": "Kazakhstan",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nraw_pa_data_pols |&gt;\n  st_drop_geometry() |&gt; \n  count(desig_eng) |&gt; \n  filter(str_detect(desig_eng, 'UNESCO-MAB'))\n\n\n# A tibble: 0 × 2\n# ℹ 2 variables: desig_eng &lt;chr&gt;, n &lt;int&gt;\n\n\n\n\nCode\ng_labels &lt;- levels(raw_pa_data_pols$iucn_cat)[\n  length(levels(raw_pa_data_pols$iucn_cat)):1\n]\nn_desig &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  pull(desig_eng) |&gt;\n  unique() |&gt;\n  length()\npas_count &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  st_drop_geometry() |&gt;\n  count(iucn_cat, desig_eng, realm) |&gt;\n  mutate(iucn_cat = factor(iucn_cat, levels = g_labels))\n\npalette_desig &lt;- paletteer::paletteer_c(\"scico::roma\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"viridis::viridis\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"scico::batlow\", n = n_desig)\n\nggplotly(\n  pas_count |&gt;\n    arrange(iucn_cat) |&gt;\n    ggplot() +\n    aes(y = iucn_cat, x = n, fill = desig_eng) +\n    geom_col() +\n    labs(y = 'IUCN categories', x = 'Count') +\n    scale_fill_manual(\n      values = palette_desig,\n      # labels = \\(x) stringr::str_wrap(x, width = 32),\n      # 'Designation'\n    ) +\n    theme_minimal() +\n    theme(\n      legend.position = 'none',\n      plot.background = element_rect(fill = background_colour),\n      axis.title = element_text(family = 'worksans')\n    ) +\n    facet_wrap(~realm, scales = 'free')\n) \n\n\n\n\n\n\n\n\nCode\nselect(iucn_palette, -hex_colour)\n\n\n# A tibble: 10 × 2\n   id             cat                                                       \n   &lt;chr&gt;          &lt;chr&gt;                                                     \n 1 Ia             Ia Strict nature reserve                                  \n 2 Ib             Ib Wilderness area                                        \n 3 II             II National park                                          \n 4 III            III Natural monument or feature                           \n 5 IV             IV Habitat/species management area                        \n 6 V              V Protected landscape/seascape                            \n 7 VI             VI Protected area with sustainable use of natural resource\n 8 Not Applicable NA Not Applicable                                         \n 9 Not Assigned   NAS Not Assigned                                          \n10 Not Reported   NR Not Reported                                           \n\n\n\n\nCode\ncolours_desig &lt;- tibble(palette_desig, desig = sort(unique(pas_count$desig_eng)))\nprep &lt;- colours_desig |&gt;\n  select(colour = palette_desig, desig_eng = desig) |&gt; \n  right_join(pas_count)\n\nprep |&gt; \n  reactable(\n    showSortable = T,\n    defaultSorted = list(n = 'desc'),\n    searchable = TRUE,\n    defaultPageSize = 20,\n    showPageSizeOptions = TRUE,\n    pageSizeOptions = c(10, 20, 50, 100, nrow(pas_count)),\n    fullWidth = F,\n    columns = list(\n      colour = colDef(\n        sortable = F,\n        name = '',\n        maxWidth = 100,\n        style = function(value) {\n          colour &lt;- value\n          list(background = colour, color = colour)\n        }\n      ),\n      desig_eng = colDef(\n        name = 'Designation',\n        minWidth = 400\n      ),\n      realm = colDef(\n        name = 'Realm'\n      ),\n      iucn_cat = colDef(\n        name = 'IUCN (cat)',\n        minWidth = 150\n      ),\n      n = colDef(\n        name = 'Count'\n      )\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Kazakhstan</span>"
    ]
  },
  {
    "objectID": "kyrgyzstan.html",
    "href": "kyrgyzstan.html",
    "title": "Kyrgyzstan",
    "section": "",
    "text": "Key Biodiversity Areas (KBAs)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Kyrgyzstan</span>"
    ]
  },
  {
    "objectID": "kyrgyzstan.html#first-stats",
    "href": "kyrgyzstan.html#first-stats",
    "title": "Kyrgyzstan",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nfile_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.shp$',\n  full.names = T\n)\n\ndf_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.xlsx$',\n  full.names = T\n)\n# readxl::excel_sheets(df_list)\n\nkbas_0 &lt;- lapply(file_list, read_sf) |&gt;\n  bind_rows() |&gt;\n  janitor::clean_names()\n\n\nkbas &lt;- kbas_0 |&gt;\n  filter(country == 'Kyrgyzstan')\n\n\ndf &lt;- readxl::read_xlsx(df_list) |&gt;\n  janitor::clean_names() |&gt;\n  filter(sit_rec_id %in% kbas$sit_rec_id)\n\n\nkbas_1 &lt;- kbas |&gt;\n  left_join(df) |&gt;\n  select(\n    sit_rec_id,\n    nat_name,\n    int_name,\n    kba_status,\n    ends_with('status'),\n    class,\n    taxon_id,\n    common_name,\n    scientific_name,\n    kba_criterias,\n    year\n  )\n\nkbas_2 &lt;- kbas_1 |&gt;\n  mutate(\n    class = str_to_title(class),\n    triggered_by_class = if_else(!is.na(kba_criterias), class, 'none'),\n    triggered_by_scinam = if_else(\n      !is.na(kba_criterias),\n      scientific_name,\n      'none'\n    )\n  )\n\nkba_3 &lt;- kbas_2 |&gt;\n  distinct(sit_rec_id, class, triggered_by_class, year) |&gt;\n  arrange(class) |&gt;\n  group_by(sit_rec_id) |&gt;\n  summarise(\n    class = paste0(class, collapse = ', '),\n    triggered_by = paste0(triggered_by_class, collapse = ', '),\n    triggered_by_birds = if_else(str_detect(triggered_by, 'Aves'), 1, 0),\n    year = unique(year)\n  ) |&gt;\n  mutate(\n    contain = case_when(\n      class == 'Aves' ~ 'Only birds',\n      str_detect(class, 'Aves') ~ 'Birds and others',\n      !str_detect(class, 'Aves') ~ 'No birds',\n\n      TRUE ~ 'check'\n    )\n  )\n\n\nkba_3$triggered_by &lt;- str_remove_all(kba_3$triggered_by, 'none|, ')\n\n# kba_3 |&gt;\n#   count(contain, triggered_by_birds)\n\nkbas_leaflet &lt;- kbas_2 |&gt;\n  mutate(\n    sci_name_class = paste0(scientific_name, ' (', class, ')'),\n    comm_name_class = paste0(common_name, ' (', class, ')')\n  ) |&gt;\n  arrange(class) |&gt;\n  # select(class, scientific_name, sci_name_class) |&gt;\n  group_by(sit_rec_id, int_name, nat_name, kba_status, year) |&gt;\n  summarise(\n    scientific_name = paste0(sci_name_class, collapse = ', '),\n    common_name = paste0(comm_name_class, collapse = ', ')\n  ) |&gt;\n  left_join(kba_3) |&gt;\n  ungroup() %&gt;%\n  filter(st_geometry_type(.) != 'POINT') |&gt;\n  st_cast('MULTIPOLYGON')\n\n\nkbas_leaflet_c &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  count(contain, triggered_by_birds, sort = T) |&gt;\n  mutate(contain = forcats::as_factor(contain), n = as.integer(n))\n\nn_kbas &lt;- length(unique(kbas_leaflet$sit_rec_id))\n\n\nn_kba_birds &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  filter(contain != 'No birds') |&gt;\n  nrow()\n\n\n# kbas_leaflet_c |&gt;\n#   ggplot() +\n#   aes(y = contain, x = n, fill = n) +\n#   geom_col() +\n#   theme_minimal()\nkbas_leaflet_c |&gt;\n  mutate(\n    triggered_by_birds = if_else(triggered_by_birds == '1', 'Yes', 'No'),\n    triggered_by_birds = factor(triggered_by_birds, levels = c('Yes', 'No'))\n  ) |&gt;\n  arrange(triggered_by_birds, contain) \n\n\n# A tibble: 5 × 3\n  contain          triggered_by_birds     n\n  &lt;fct&gt;            &lt;fct&gt;              &lt;int&gt;\n1 Only birds       Yes                    1\n2 Birds and others Yes                    4\n3 Only birds       No                     5\n4 Birds and others No                     1\n5 No birds         No                     1\n\n\nCode\n  # ggplot() +\n  # aes(x = contain, y = n, fill = triggered_by_birds) +\n  # geom_col() +\n  # labs(x = NULL, y = 'Count') +\n\n  # scale_fill_manual('Triggered by birds?', values = c('#333333', '#d6d4cfff')) +\n  # # scale_fill_manual('Triggered by birds?', values = c('#7D804BFF', '#E6EEE0FF')) +\n  # theme_minimal() +\n  # theme(\n  #   legend.position = 'bottom',\n  #   plot.background = element_rect(fill = background_colour),\n  #   axis.title = element_text(family = 'worksans')\n  # )\n\n\n\n\n\n\n\n\n\n\nTotal number of KBAs\n\n\n\n12\n\n\n\n\n\n\n\n\n\n\nNumber of KBAs with Birds\n\n\n\n11\n\n\n\n\n\n\nCode\n# glimpse(raw_pa_data)\n# st_geometry_type(raw_pa_data) == 'MULTIPOLYGON'\nraw_pa_data_pols &lt;- raw_pa_data |&gt;\n  filter(st_geometry_type(raw_pa_data) == 'MULTIPOLYGON') |&gt;\n  mutate(\n    iucn_cat = factor(\n      iucn_cat,\n      levels = c(\n        'Ia',\n        'Ib',\n        'II',\n        'III',\n        'IV',\n        'V',\n        'VI',\n        'Not Applicable',\n        'Not Reported',\n        'Not Assigned'\n      )\n    ),\n    realm = factor(realm, levels = c('Coastal', 'Marine', 'Terrestrial'))\n  )\n\n# raw_pa_data_pols$iucn_cat\n# raw_pa_data |&gt;\n#   st_drop_geometry() |&gt;\n#   count(status)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Kyrgyzstan</span>"
    ]
  },
  {
    "objectID": "kyrgyzstan.html#kbas-map",
    "href": "kyrgyzstan.html#kbas-map",
    "title": "Kyrgyzstan",
    "section": "KBAs map",
    "text": "KBAs map\n\n\nCode\n# kbas_leaflet$contain |&gt; unique() |&gt; sort()\n\nkbas_leaflet &lt;- kbas_leaflet |&gt;\n  arrange(contain) |&gt;\n  mutate(contain = forcats::as_factor(contain))\n\n\npal_kbas &lt;- colorFactor(\n  domain = levels(kbas_leaflet$contain),\n  palette = c('#2e6ba6', '#e53d3d', '#59de9e')\n)\n\niucn_palette &lt;- tribble(\n  ~id, ~cat, ~hex_colour,\n  'Ia', 'Ia Strict nature reserve', '#174721', \n  'Ib', 'Ib Wilderness area', '#7AC141',\n  'II', 'II National park', '#5D873B',\n  'III', 'III Natural monument or feature', '#AFBD36',\n  'IV', 'IV Habitat/species management area', '#C8DF8D',\n  'V', 'V Protected landscape/seascape', '#15477C',\n  'VI', 'VI Protected area with sustainable use of natural resource', '#7EA1B5',\n  'Not Applicable', 'NA Not Applicable', '#894444',\n  'Not Assigned', 'NAS Not Assigned', '#E60000',\n  'Not Reported', 'NR Not Reported', '#898944'\n)\n\niucn_palette &lt;- iucn_palette |&gt; \n  filter(id %in% levels(raw_pa_data_pols$iucn_cat))\n\npal &lt;- colorFactor(\n  domain = levels(raw_pa_data_pols$iucn_cat),\n  palette = iucn_palette$hex_colour\n)\n# pal &lt;- colorFactor(\n#   domain = levels(raw_pa_data_pols$iucn_cat),\n#   c(\n#     '#232021',\n#     '#426f41',\n#     '#59ba49',\n#     '#c1178d',\n#     '#feb016',\n#     '#e61e24'\n#   )\n# )\n\nbasemap_leaflet |&gt;\n  addPolygons(\n    data = kbas_leaflet,\n    fillOpacity = 1,\n    fillColor = ~ pal_kbas(contain),\n    stroke = TRUE,\n    color = '#333333',\n    weight = ~ (triggered_by_birds * 2) + 0.5,\n    opacity = 1,\n    group = 'KBAs',\n    # label = ~ htmltools::htmlEscape(desig_eng),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      kbas_leaflet$int_name,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;a href=\"https://www.keybiodiversityareas.org/site/factsheet/',\n      kbas_leaflet$sit_rec_id,\n      '/assessment\", target=\"_blank\"&gt;Factsheet&lt;/a&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Groups: &lt;/b&gt;',\n      kbas_leaflet$contain,\n      '&lt;/br&gt;',\n      '&lt;b&gt;National site name: &lt;/b&gt;',\n      kbas_leaflet$nat_name,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Triggered by: &lt;/b&gt;',\n      kbas_leaflet$triggered_by,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Year of last assessment: &lt;/b&gt;',\n      kbas_leaflet$year\n    )\n  ) |&gt;\n\n  addPolygons(\n    data = raw_pa_data_pols,\n    weight = 0.5,\n    fillOpacity = 0.7,\n    fillColor = ~ pal(iucn_cat),\n    # stroke = FALSE,\n    color = '#333333',\n    opacity = 0.7,\n    group = 'Protected areas',\n    label = ~ htmltools::htmlEscape(desig_eng),\n    # label = ~ htmltools::htmlEscape(iucn_cat),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      raw_pa_data_pols$name_eng,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Designation: &lt;/b&gt;',\n      raw_pa_data_pols$desig_eng,\n      '&lt;/br&gt;',\n      '&lt;b&gt;IUCN category: &lt;/b&gt;',\n      raw_pa_data_pols$iucn_cat,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Realm: &lt;/b&gt;',\n      raw_pa_data_pols$realm,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Status (year): &lt;/b&gt;',\n      raw_pa_data_pols$status,\n      ' (',\n      raw_pa_data_pols$status_yr,\n      ')'\n    )\n  ) |&gt;\n  addLegend(\n    data = kbas_leaflet,\n    pal = pal_kbas,\n    values = levels(kbas_leaflet$contain),\n    opacity = 0.9,\n    group = 'KBAs',\n    title = 'KBAs'\n  ) |&gt;\n  addLegend(\n    data = raw_pa_data_pols,\n    pal = pal,\n    values = levels(raw_pa_data_pols$iucn_cat),\n    opacity = 0.9,\n    group = 'Protected areas',\n    title = \"Protected areas &lt;/br&gt; IUCN cats\"\n  ) |&gt;\n  addLayersControl(\n    baseGroups = c(\n      # \"Topography\",\n      \"Open Street Map\",\n      \"Satellite\"\n      \n      # \"Terrain\",\n    ),\n    overlayGroups = c(\n      'KBAs',\n      'Protected areas'\n    ),\n    options = layersControlOptions(collapsed = FALSE, position = \"bottomright\")\n  ) |&gt;\n  hideGroup(c('Protected areas')) |&gt;\n  addScaleBar(position = c(\"bottomleft\"), options = scaleBarOptions())",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Kyrgyzstan</span>"
    ]
  },
  {
    "objectID": "kyrgyzstan.html#first-stats-1",
    "href": "kyrgyzstan.html#first-stats-1",
    "title": "Kyrgyzstan",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nraw_pa_data_pols |&gt;\n  st_drop_geometry() |&gt; \n  count(desig_eng) |&gt; \n  filter(str_detect(desig_eng, 'UNESCO-MAB'))\n\n\n# A tibble: 1 × 2\n  desig_eng                        n\n  &lt;chr&gt;                        &lt;int&gt;\n1 UNESCO-MAB Biosphere Reserve     1\n\n\n\n\nCode\ng_labels &lt;- levels(raw_pa_data_pols$iucn_cat)[\n  length(levels(raw_pa_data_pols$iucn_cat)):1\n]\nn_desig &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  pull(desig_eng) |&gt;\n  unique() |&gt;\n  length()\npas_count &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  st_drop_geometry() |&gt;\n  count(iucn_cat, desig_eng, realm) |&gt;\n  mutate(iucn_cat = factor(iucn_cat, levels = g_labels))\n\npalette_desig &lt;- paletteer::paletteer_c(\"scico::roma\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"viridis::viridis\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"scico::batlow\", n = n_desig)\n\nggplotly(\n  pas_count |&gt;\n    arrange(iucn_cat) |&gt;\n    ggplot() +\n    aes(y = iucn_cat, x = n, fill = desig_eng) +\n    geom_col() +\n    labs(y = 'IUCN categories', x = 'Count') +\n    scale_fill_manual(\n      values = palette_desig,\n      # labels = \\(x) stringr::str_wrap(x, width = 32),\n      # 'Designation'\n    ) +\n    theme_minimal() +\n    theme(\n      legend.position = 'none',\n      plot.background = element_rect(fill = background_colour),\n      axis.title = element_text(family = 'worksans')\n    ) +\n    facet_wrap(~realm, scales = 'free')\n) \n\n\n\n\n\n\n\n\nCode\nselect(iucn_palette, -hex_colour)\n\n\n# A tibble: 10 × 2\n   id             cat                                                       \n   &lt;chr&gt;          &lt;chr&gt;                                                     \n 1 Ia             Ia Strict nature reserve                                  \n 2 Ib             Ib Wilderness area                                        \n 3 II             II National park                                          \n 4 III            III Natural monument or feature                           \n 5 IV             IV Habitat/species management area                        \n 6 V              V Protected landscape/seascape                            \n 7 VI             VI Protected area with sustainable use of natural resource\n 8 Not Applicable NA Not Applicable                                         \n 9 Not Assigned   NAS Not Assigned                                          \n10 Not Reported   NR Not Reported                                           \n\n\n\n\nCode\ncolours_desig &lt;- tibble(palette_desig, desig = sort(unique(pas_count$desig_eng)))\nprep &lt;- colours_desig |&gt;\n  select(colour = palette_desig, desig_eng = desig) |&gt; \n  right_join(pas_count)\n\nprep |&gt; \n  reactable(\n    showSortable = T,\n    defaultSorted = list(n = 'desc'),\n    searchable = TRUE,\n    defaultPageSize = 20,\n    showPageSizeOptions = TRUE,\n    pageSizeOptions = c(10, 20, 50, 100, nrow(pas_count)),\n    fullWidth = F,\n    columns = list(\n      colour = colDef(\n        sortable = F,\n        name = '',\n        maxWidth = 100,\n        style = function(value) {\n          colour &lt;- value\n          list(background = colour, color = colour)\n        }\n      ),\n      desig_eng = colDef(\n        name = 'Designation',\n        minWidth = 400\n      ),\n      realm = colDef(\n        name = 'Realm'\n      ),\n      iucn_cat = colDef(\n        name = 'IUCN (cat)',\n        minWidth = 150\n      ),\n      n = colDef(\n        name = 'Count'\n      )\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Kyrgyzstan</span>"
    ]
  },
  {
    "objectID": "philippines.html",
    "href": "philippines.html",
    "title": "Philippines",
    "section": "",
    "text": "Key Biodiversity Areas (KBAs)",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Philippines</span>"
    ]
  },
  {
    "objectID": "philippines.html#first-stats",
    "href": "philippines.html#first-stats",
    "title": "Philippines",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nfile_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.shp$',\n  full.names = T\n)\n\ndf_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.xlsx$',\n  full.names = T\n)\n# readxl::excel_sheets(df_list)\n\nkbas_0 &lt;- lapply(file_list, read_sf) |&gt;\n  bind_rows() |&gt;\n  janitor::clean_names()\n\n\nkbas &lt;- kbas_0 |&gt;\n  filter(country == 'Philippines')\n\n\ndf &lt;- readxl::read_xlsx(df_list) |&gt;\n  janitor::clean_names() |&gt;\n  filter(sit_rec_id %in% kbas$sit_rec_id)\n\n\nkbas_1 &lt;- kbas |&gt;\n  left_join(df) |&gt;\n  select(\n    sit_rec_id,\n    nat_name,\n    int_name,\n    kba_status,\n    ends_with('status'),\n    class,\n    taxon_id,\n    common_name,\n    scientific_name,\n    kba_criterias,\n    year\n  )\n\nkbas_2 &lt;- kbas_1 |&gt;\n  mutate(\n    class = str_to_title(class),\n    triggered_by_class = if_else(!is.na(kba_criterias), class, 'none'),\n    triggered_by_scinam = if_else(\n      !is.na(kba_criterias),\n      scientific_name,\n      'none'\n    )\n  )\n\nkba_3 &lt;- kbas_2 |&gt;\n  distinct(sit_rec_id, class, triggered_by_class, year) |&gt;\n  arrange(class) |&gt;\n  group_by(sit_rec_id) |&gt;\n  summarise(\n    class = paste0(class, collapse = ', '),\n    triggered_by = paste0(triggered_by_class, collapse = ', '),\n    triggered_by_birds = if_else(str_detect(triggered_by, 'Aves'), 1, 0),\n    year = unique(year)\n  ) |&gt;\n  mutate(\n    contain = case_when(\n      class == 'Aves' ~ 'Only birds',\n      str_detect(class, 'Aves') ~ 'Birds and others',\n      !str_detect(class, 'Aves') ~ 'No birds',\n\n      TRUE ~ 'check'\n    )\n  )\n\n\nkba_3$triggered_by &lt;- str_remove_all(kba_3$triggered_by, 'none|, ')\n\n# kba_3 |&gt;\n#   count(contain, triggered_by_birds)\n\nkbas_leaflet &lt;- kbas_2 |&gt;\n  mutate(\n    sci_name_class = paste0(scientific_name, ' (', class, ')'),\n    comm_name_class = paste0(common_name, ' (', class, ')')\n  ) |&gt;\n  arrange(class) |&gt;\n  # select(class, scientific_name, sci_name_class) |&gt;\n  group_by(sit_rec_id, int_name, nat_name, kba_status, year) |&gt;\n  summarise(\n    scientific_name = paste0(sci_name_class, collapse = ', '),\n    common_name = paste0(comm_name_class, collapse = ', ')\n  ) |&gt;\n  left_join(kba_3) |&gt;\n  ungroup() %&gt;%\n  filter(st_geometry_type(.) != 'POINT') |&gt;\n  st_cast('MULTIPOLYGON')\n\n\nkbas_leaflet_c &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  count(contain, triggered_by_birds, sort = T) |&gt;\n  mutate(contain = forcats::as_factor(contain), n = as.integer(n))\n\nn_kbas &lt;- length(unique(kbas_leaflet$sit_rec_id))\n\n\nn_kba_birds &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  filter(contain != 'No birds') |&gt;\n  nrow()\n\n\n# kbas_leaflet_c |&gt;\n#   ggplot() +\n#   aes(y = contain, x = n, fill = n) +\n#   geom_col() +\n#   theme_minimal()\nkbas_leaflet_c |&gt;\n  mutate(\n    triggered_by_birds = if_else(triggered_by_birds == '1', 'Yes', 'No'),\n    triggered_by_birds = factor(triggered_by_birds, levels = c('Yes', 'No'))\n  ) |&gt;\n  arrange(triggered_by_birds, contain) \n\n\n# A tibble: 4 × 3\n  contain          triggered_by_birds     n\n  &lt;fct&gt;            &lt;fct&gt;              &lt;int&gt;\n1 Birds and others Yes                   58\n2 Birds and others No                    53\n3 Only birds       No                    18\n4 No birds         No                     8\n\n\nCode\n  # ggplot() +\n  # aes(x = contain, y = n, fill = triggered_by_birds) +\n  # geom_col() +\n  # labs(x = NULL, y = 'Count') +\n\n  # scale_fill_manual('Triggered by birds?', values = c('#333333', '#d6d4cfff')) +\n  # # scale_fill_manual('Triggered by birds?', values = c('#7D804BFF', '#E6EEE0FF')) +\n  # theme_minimal() +\n  # theme(\n  #   legend.position = 'bottom',\n  #   plot.background = element_rect(fill = background_colour),\n  #   axis.title = element_text(family = 'worksans')\n  # )\n\n\n\n\n\n\n\n\n\n\nTotal number of KBAs\n\n\n\n137\n\n\n\n\n\n\n\n\n\n\nNumber of KBAs with Birds\n\n\n\n129\n\n\n\n\n\n\nCode\n# glimpse(raw_pa_data)\n# st_geometry_type(raw_pa_data) == 'MULTIPOLYGON'\nraw_pa_data_pols &lt;- raw_pa_data |&gt;\n  filter(st_geometry_type(raw_pa_data) == 'MULTIPOLYGON') |&gt;\n  mutate(\n    iucn_cat = factor(\n      iucn_cat,\n      levels = c(\n        'Ia',\n        'Ib',\n        'II',\n        'III',\n        'IV',\n        'V',\n        'VI',\n        'Not Applicable',\n        'Not Reported',\n        'Not Assigned'\n      )\n    ),\n    realm = factor(realm, levels = c('Coastal', 'Marine', 'Terrestrial'))\n  )\n\n# raw_pa_data_pols$iucn_cat\n# raw_pa_data |&gt;\n#   st_drop_geometry() |&gt;\n#   count(status)",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Philippines</span>"
    ]
  },
  {
    "objectID": "philippines.html#kbas-map",
    "href": "philippines.html#kbas-map",
    "title": "Philippines",
    "section": "KBAs map",
    "text": "KBAs map\n\n\nCode\n# kbas_leaflet$contain |&gt; unique() |&gt; sort()\n\nkbas_leaflet &lt;- kbas_leaflet |&gt;\n  arrange(contain) |&gt;\n  mutate(contain = forcats::as_factor(contain))\n\n\npal_kbas &lt;- colorFactor(\n  domain = levels(kbas_leaflet$contain),\n  palette = c('#2e6ba6', '#e53d3d', '#59de9e')\n)\n\niucn_palette &lt;- tribble(\n  ~id, ~cat, ~hex_colour,\n  'Ia', 'Ia Strict nature reserve', '#174721', \n  'Ib', 'Ib Wilderness area', '#7AC141',\n  'II', 'II National park', '#5D873B',\n  'III', 'III Natural monument or feature', '#AFBD36',\n  'IV', 'IV Habitat/species management area', '#C8DF8D',\n  'V', 'V Protected landscape/seascape', '#15477C',\n  'VI', 'VI Protected area with sustainable use of natural resource', '#7EA1B5',\n  'Not Applicable', 'NA Not Applicable', '#894444',\n  'Not Assigned', 'NAS Not Assigned', '#E60000',\n  'Not Reported', 'NR Not Reported', '#898944'\n)\n\niucn_palette &lt;- iucn_palette |&gt; \n  filter(id %in% levels(raw_pa_data_pols$iucn_cat))\n\npal &lt;- colorFactor(\n  domain = levels(raw_pa_data_pols$iucn_cat),\n  palette = iucn_palette$hex_colour\n)\n# pal &lt;- colorFactor(\n#   domain = levels(raw_pa_data_pols$iucn_cat),\n#   c(\n#     '#232021',\n#     '#426f41',\n#     '#59ba49',\n#     '#c1178d',\n#     '#feb016',\n#     '#e61e24'\n#   )\n# )\n\nbasemap_leaflet |&gt;\n  addPolygons(\n    data = kbas_leaflet,\n    fillOpacity = 1,\n    fillColor = ~ pal_kbas(contain),\n    stroke = TRUE,\n    color = '#333333',\n    weight = ~ (triggered_by_birds * 2) + 0.5,\n    opacity = 1,\n    group = 'KBAs',\n    # label = ~ htmltools::htmlEscape(desig_eng),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      kbas_leaflet$int_name,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;a href=\"https://www.keybiodiversityareas.org/site/factsheet/',\n      kbas_leaflet$sit_rec_id,\n      '/assessment\", target=\"_blank\"&gt;Factsheet&lt;/a&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Groups: &lt;/b&gt;',\n      kbas_leaflet$contain,\n      '&lt;/br&gt;',\n      '&lt;b&gt;National site name: &lt;/b&gt;',\n      kbas_leaflet$nat_name,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Triggered by: &lt;/b&gt;',\n      kbas_leaflet$triggered_by,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Year of last assessment: &lt;/b&gt;',\n      kbas_leaflet$year\n    )\n  ) |&gt;\n\n  addPolygons(\n    data = raw_pa_data_pols,\n    weight = 0.5,\n    fillOpacity = 0.7,\n    fillColor = ~ pal(iucn_cat),\n    # stroke = FALSE,\n    color = '#333333',\n    opacity = 0.7,\n    group = 'Protected areas',\n    label = ~ htmltools::htmlEscape(desig_eng),\n    # label = ~ htmltools::htmlEscape(iucn_cat),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      raw_pa_data_pols$name_eng,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Designation: &lt;/b&gt;',\n      raw_pa_data_pols$desig_eng,\n      '&lt;/br&gt;',\n      '&lt;b&gt;IUCN category: &lt;/b&gt;',\n      raw_pa_data_pols$iucn_cat,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Realm: &lt;/b&gt;',\n      raw_pa_data_pols$realm,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Status (year): &lt;/b&gt;',\n      raw_pa_data_pols$status,\n      ' (',\n      raw_pa_data_pols$status_yr,\n      ')'\n    )\n  ) |&gt;\n  addLegend(\n    data = kbas_leaflet,\n    pal = pal_kbas,\n    values = levels(kbas_leaflet$contain),\n    opacity = 0.9,\n    group = 'KBAs',\n    title = 'KBAs'\n  ) |&gt;\n  addLegend(\n    data = raw_pa_data_pols,\n    pal = pal,\n    values = levels(raw_pa_data_pols$iucn_cat),\n    opacity = 0.9,\n    group = 'Protected areas',\n    title = \"Protected areas &lt;/br&gt; IUCN cats\"\n  ) |&gt;\n  addLayersControl(\n    baseGroups = c(\n      # \"Topography\",\n      \"Open Street Map\",\n      \"Satellite\"\n      \n      # \"Terrain\",\n    ),\n    overlayGroups = c(\n      'KBAs',\n      'Protected areas'\n    ),\n    options = layersControlOptions(collapsed = FALSE, position = \"bottomright\")\n  ) |&gt;\n  hideGroup(c('Protected areas')) |&gt;\n  addScaleBar(position = c(\"bottomleft\"), options = scaleBarOptions())",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Philippines</span>"
    ]
  },
  {
    "objectID": "philippines.html#first-stats-1",
    "href": "philippines.html#first-stats-1",
    "title": "Philippines",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nraw_pa_data_pols |&gt;\n  st_drop_geometry() |&gt; \n  count(desig_eng) |&gt; \n  filter(str_detect(desig_eng, 'UNESCO-MAB'))\n\n\n# A tibble: 0 × 2\n# ℹ 2 variables: desig_eng &lt;chr&gt;, n &lt;int&gt;\n\n\n\n\nCode\ng_labels &lt;- levels(raw_pa_data_pols$iucn_cat)[\n  length(levels(raw_pa_data_pols$iucn_cat)):1\n]\nn_desig &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  pull(desig_eng) |&gt;\n  unique() |&gt;\n  length()\npas_count &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  st_drop_geometry() |&gt;\n  count(iucn_cat, desig_eng, realm) |&gt;\n  mutate(iucn_cat = factor(iucn_cat, levels = g_labels))\n\npalette_desig &lt;- paletteer::paletteer_c(\"scico::roma\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"viridis::viridis\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"scico::batlow\", n = n_desig)\n\nggplotly(\n  pas_count |&gt;\n    arrange(iucn_cat) |&gt;\n    ggplot() +\n    aes(y = iucn_cat, x = n, fill = desig_eng) +\n    geom_col() +\n    labs(y = 'IUCN categories', x = 'Count') +\n    scale_fill_manual(\n      values = palette_desig,\n      # labels = \\(x) stringr::str_wrap(x, width = 32),\n      # 'Designation'\n    ) +\n    theme_minimal() +\n    theme(\n      legend.position = 'none',\n      plot.background = element_rect(fill = background_colour),\n      axis.title = element_text(family = 'worksans')\n    ) +\n    facet_wrap(~realm, scales = 'free')\n) \n\n\n\n\n\n\n\n\nCode\nselect(iucn_palette, -hex_colour)\n\n\n# A tibble: 10 × 2\n   id             cat                                                       \n   &lt;chr&gt;          &lt;chr&gt;                                                     \n 1 Ia             Ia Strict nature reserve                                  \n 2 Ib             Ib Wilderness area                                        \n 3 II             II National park                                          \n 4 III            III Natural monument or feature                           \n 5 IV             IV Habitat/species management area                        \n 6 V              V Protected landscape/seascape                            \n 7 VI             VI Protected area with sustainable use of natural resource\n 8 Not Applicable NA Not Applicable                                         \n 9 Not Assigned   NAS Not Assigned                                          \n10 Not Reported   NR Not Reported                                           \n\n\n\n\nCode\ncolours_desig &lt;- tibble(palette_desig, desig = sort(unique(pas_count$desig_eng)))\nprep &lt;- colours_desig |&gt;\n  select(colour = palette_desig, desig_eng = desig) |&gt; \n  right_join(pas_count)\n\nprep |&gt; \n  reactable(\n    showSortable = T,\n    defaultSorted = list(n = 'desc'),\n    searchable = TRUE,\n    defaultPageSize = 20,\n    showPageSizeOptions = TRUE,\n    pageSizeOptions = c(10, 20, 50, 100, nrow(pas_count)),\n    fullWidth = F,\n    columns = list(\n      colour = colDef(\n        sortable = F,\n        name = '',\n        maxWidth = 100,\n        style = function(value) {\n          colour &lt;- value\n          list(background = colour, color = colour)\n        }\n      ),\n      desig_eng = colDef(\n        name = 'Designation',\n        minWidth = 400\n      ),\n      realm = colDef(\n        name = 'Realm'\n      ),\n      iucn_cat = colDef(\n        name = 'IUCN (cat)',\n        minWidth = 150\n      ),\n      n = colDef(\n        name = 'Count'\n      )\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Philippines</span>"
    ]
  },
  {
    "objectID": "turkmenistan.html",
    "href": "turkmenistan.html",
    "title": "Turkmenistan",
    "section": "",
    "text": "Key Biodiversity Areas (KBAs)",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Turkmenistan</span>"
    ]
  },
  {
    "objectID": "turkmenistan.html#first-stats",
    "href": "turkmenistan.html#first-stats",
    "title": "Turkmenistan",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nfile_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.shp$',\n  full.names = T\n)\n\ndf_list &lt;- list.files(\n  '../../base_gis/KBAsGlobal_2025_September_02',\n  pattern = '\\\\.xlsx$',\n  full.names = T\n)\n# readxl::excel_sheets(df_list)\n\nkbas_0 &lt;- lapply(file_list, read_sf) |&gt;\n  bind_rows() |&gt;\n  janitor::clean_names()\n\n\nkbas &lt;- kbas_0 |&gt;\n  filter(country == 'Turkmenistan')\n\n\ndf &lt;- readxl::read_xlsx(df_list) |&gt;\n  janitor::clean_names() |&gt;\n  filter(sit_rec_id %in% kbas$sit_rec_id)\n\n\nkbas_1 &lt;- kbas |&gt;\n  left_join(df) |&gt;\n  select(\n    sit_rec_id,\n    nat_name,\n    int_name,\n    kba_status,\n    ends_with('status'),\n    class,\n    taxon_id,\n    common_name,\n    scientific_name,\n    kba_criterias,\n    year\n  )\n\nkbas_2 &lt;- kbas_1 |&gt;\n  mutate(\n    class = str_to_title(class),\n    triggered_by_class = if_else(!is.na(kba_criterias), class, 'none'),\n    triggered_by_scinam = if_else(\n      !is.na(kba_criterias),\n      scientific_name,\n      'none'\n    )\n  )\n\nkba_3 &lt;- kbas_2 |&gt;\n  distinct(sit_rec_id, class, triggered_by_class, year) |&gt;\n  arrange(class) |&gt;\n  group_by(sit_rec_id) |&gt;\n  summarise(\n    class = paste0(class, collapse = ', '),\n    triggered_by = paste0(triggered_by_class, collapse = ', '),\n    triggered_by_birds = if_else(str_detect(triggered_by, 'Aves'), 1, 0),\n    year = unique(year)\n  ) |&gt;\n  mutate(\n    contain = case_when(\n      class == 'Aves' ~ 'Only birds',\n      str_detect(class, 'Aves') ~ 'Birds and others',\n      !str_detect(class, 'Aves') ~ 'No birds',\n\n      TRUE ~ 'check'\n    )\n  )\n\n\nkba_3$triggered_by &lt;- str_remove_all(kba_3$triggered_by, 'none|, ')\n\n# kba_3 |&gt;\n#   count(contain, triggered_by_birds)\n\nkbas_leaflet &lt;- kbas_2 |&gt;\n  mutate(\n    sci_name_class = paste0(scientific_name, ' (', class, ')'),\n    comm_name_class = paste0(common_name, ' (', class, ')')\n  ) |&gt;\n  arrange(class) |&gt;\n  # select(class, scientific_name, sci_name_class) |&gt;\n  group_by(sit_rec_id, int_name, nat_name, kba_status, year) |&gt;\n  summarise(\n    scientific_name = paste0(sci_name_class, collapse = ', '),\n    common_name = paste0(comm_name_class, collapse = ', ')\n  ) |&gt;\n  left_join(kba_3) |&gt;\n  ungroup() %&gt;%\n  filter(st_geometry_type(.) != 'POINT') |&gt;\n  st_cast('MULTIPOLYGON')\n\n\nkbas_leaflet_c &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  count(contain, triggered_by_birds, sort = T) |&gt;\n  mutate(contain = forcats::as_factor(contain), n = as.integer(n))\n\nn_kbas &lt;- length(unique(kbas_leaflet$sit_rec_id))\n\n\nn_kba_birds &lt;- kbas_leaflet |&gt;\n  st_drop_geometry() |&gt;\n  filter(contain != 'No birds') |&gt;\n  nrow()\n\n\n# kbas_leaflet_c |&gt;\n#   ggplot() +\n#   aes(y = contain, x = n, fill = n) +\n#   geom_col() +\n#   theme_minimal()\nkbas_leaflet_c |&gt;\n  mutate(\n    triggered_by_birds = if_else(triggered_by_birds == '1', 'Yes', 'No'),\n    triggered_by_birds = factor(triggered_by_birds, levels = c('Yes', 'No'))\n  ) |&gt;\n  arrange(triggered_by_birds, contain) \n\n\n# A tibble: 3 × 3\n  contain          triggered_by_birds     n\n  &lt;fct&gt;            &lt;fct&gt;              &lt;int&gt;\n1 Birds and others Yes                   19\n2 Only birds       No                    27\n3 No birds         No                     1\n\n\nCode\n  # ggplot() +\n  # aes(x = contain, y = n, fill = triggered_by_birds) +\n  # geom_col() +\n  # labs(x = NULL, y = 'Count') +\n\n  # scale_fill_manual('Triggered by birds?', values = c('#333333', '#d6d4cfff')) +\n  # # scale_fill_manual('Triggered by birds?', values = c('#7D804BFF', '#E6EEE0FF')) +\n  # theme_minimal() +\n  # theme(\n  #   legend.position = 'bottom',\n  #   plot.background = element_rect(fill = background_colour),\n  #   axis.title = element_text(family = 'worksans')\n  # )\n\n\n\n\n\n\n\n\n\n\nTotal number of KBAs\n\n\n\n47\n\n\n\n\n\n\n\n\n\n\nNumber of KBAs with Birds\n\n\n\n46\n\n\n\n\n\n\nCode\n# glimpse(raw_pa_data)\n# st_geometry_type(raw_pa_data) == 'MULTIPOLYGON'\nraw_pa_data_pols &lt;- raw_pa_data |&gt;\n  filter(st_geometry_type(raw_pa_data) == 'MULTIPOLYGON') |&gt;\n  mutate(\n    iucn_cat = factor(\n      iucn_cat,\n      levels = c(\n        'Ia',\n        'Ib',\n        'II',\n        'III',\n        'IV',\n        'V',\n        'VI',\n        'Not Applicable',\n        'Not Reported',\n        'Not Assigned'\n      )\n    ),\n    realm = factor(realm, levels = c('Coastal', 'Marine', 'Terrestrial'))\n  )\n\n# raw_pa_data_pols$iucn_cat\n# raw_pa_data |&gt;\n#   st_drop_geometry() |&gt;\n#   count(status)",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Turkmenistan</span>"
    ]
  },
  {
    "objectID": "turkmenistan.html#kbas-map",
    "href": "turkmenistan.html#kbas-map",
    "title": "Turkmenistan",
    "section": "KBAs map",
    "text": "KBAs map\n\n\nCode\n# kbas_leaflet$contain |&gt; unique() |&gt; sort()\n\nkbas_leaflet &lt;- kbas_leaflet |&gt;\n  arrange(contain) |&gt;\n  mutate(contain = forcats::as_factor(contain))\n\n\npal_kbas &lt;- colorFactor(\n  domain = levels(kbas_leaflet$contain),\n  palette = c('#2e6ba6', '#e53d3d', '#59de9e')\n)\n\niucn_palette &lt;- tribble(\n  ~id, ~cat, ~hex_colour,\n  'Ia', 'Ia Strict nature reserve', '#174721', \n  'Ib', 'Ib Wilderness area', '#7AC141',\n  'II', 'II National park', '#5D873B',\n  'III', 'III Natural monument or feature', '#AFBD36',\n  'IV', 'IV Habitat/species management area', '#C8DF8D',\n  'V', 'V Protected landscape/seascape', '#15477C',\n  'VI', 'VI Protected area with sustainable use of natural resource', '#7EA1B5',\n  'Not Applicable', 'NA Not Applicable', '#894444',\n  'Not Assigned', 'NAS Not Assigned', '#E60000',\n  'Not Reported', 'NR Not Reported', '#898944'\n)\n\niucn_palette &lt;- iucn_palette |&gt; \n  filter(id %in% levels(raw_pa_data_pols$iucn_cat))\n\npal &lt;- colorFactor(\n  domain = levels(raw_pa_data_pols$iucn_cat),\n  palette = iucn_palette$hex_colour\n)\n# pal &lt;- colorFactor(\n#   domain = levels(raw_pa_data_pols$iucn_cat),\n#   c(\n#     '#232021',\n#     '#426f41',\n#     '#59ba49',\n#     '#c1178d',\n#     '#feb016',\n#     '#e61e24'\n#   )\n# )\n\nbasemap_leaflet |&gt;\n  addPolygons(\n    data = kbas_leaflet,\n    fillOpacity = 1,\n    fillColor = ~ pal_kbas(contain),\n    stroke = TRUE,\n    color = '#333333',\n    weight = ~ (triggered_by_birds * 2) + 0.5,\n    opacity = 1,\n    group = 'KBAs',\n    # label = ~ htmltools::htmlEscape(desig_eng),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      kbas_leaflet$int_name,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;a href=\"https://www.keybiodiversityareas.org/site/factsheet/',\n      kbas_leaflet$sit_rec_id,\n      '/assessment\", target=\"_blank\"&gt;Factsheet&lt;/a&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Groups: &lt;/b&gt;',\n      kbas_leaflet$contain,\n      '&lt;/br&gt;',\n      '&lt;b&gt;National site name: &lt;/b&gt;',\n      kbas_leaflet$nat_name,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Triggered by: &lt;/b&gt;',\n      kbas_leaflet$triggered_by,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Year of last assessment: &lt;/b&gt;',\n      kbas_leaflet$year\n    )\n  ) |&gt;\n\n  addPolygons(\n    data = raw_pa_data_pols,\n    weight = 0.5,\n    fillOpacity = 0.7,\n    fillColor = ~ pal(iucn_cat),\n    # stroke = FALSE,\n    color = '#333333',\n    opacity = 0.7,\n    group = 'Protected areas',\n    label = ~ htmltools::htmlEscape(desig_eng),\n    # label = ~ htmltools::htmlEscape(iucn_cat),\n    options = pathOptions(pane = \"polygons\"),\n    popup = paste0(\n      '&lt;b&gt;',\n      raw_pa_data_pols$name_eng,\n      '&lt;/b&gt;',\n      '&lt;/br&gt;',\n      '&lt;/br&gt;',\n      '&lt;b&gt;Designation: &lt;/b&gt;',\n      raw_pa_data_pols$desig_eng,\n      '&lt;/br&gt;',\n      '&lt;b&gt;IUCN category: &lt;/b&gt;',\n      raw_pa_data_pols$iucn_cat,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Realm: &lt;/b&gt;',\n      raw_pa_data_pols$realm,\n      '&lt;/br&gt;',\n      '&lt;b&gt;Status (year): &lt;/b&gt;',\n      raw_pa_data_pols$status,\n      ' (',\n      raw_pa_data_pols$status_yr,\n      ')'\n    )\n  ) |&gt;\n  addLegend(\n    data = kbas_leaflet,\n    pal = pal_kbas,\n    values = levels(kbas_leaflet$contain),\n    opacity = 0.9,\n    group = 'KBAs',\n    title = 'KBAs'\n  ) |&gt;\n  addLegend(\n    data = raw_pa_data_pols,\n    pal = pal,\n    values = levels(raw_pa_data_pols$iucn_cat),\n    opacity = 0.9,\n    group = 'Protected areas',\n    title = \"Protected areas &lt;/br&gt; IUCN cats\"\n  ) |&gt;\n  addLayersControl(\n    baseGroups = c(\n      # \"Topography\",\n      \"Open Street Map\",\n      \"Satellite\"\n      \n      # \"Terrain\",\n    ),\n    overlayGroups = c(\n      'KBAs',\n      'Protected areas'\n    ),\n    options = layersControlOptions(collapsed = FALSE, position = \"bottomright\")\n  ) |&gt;\n  hideGroup(c('Protected areas')) |&gt;\n  addScaleBar(position = c(\"bottomleft\"), options = scaleBarOptions())",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Turkmenistan</span>"
    ]
  },
  {
    "objectID": "turkmenistan.html#first-stats-1",
    "href": "turkmenistan.html#first-stats-1",
    "title": "Turkmenistan",
    "section": "first stats",
    "text": "first stats\n\n\nCode\nraw_pa_data_pols |&gt;\n  st_drop_geometry() |&gt; \n  count(desig_eng) |&gt; \n  filter(str_detect(desig_eng, 'UNESCO-MAB'))\n\n\n# A tibble: 1 × 2\n  desig_eng                        n\n  &lt;chr&gt;                        &lt;int&gt;\n1 UNESCO-MAB Biosphere Reserve     1\n\n\n\n\nCode\ng_labels &lt;- levels(raw_pa_data_pols$iucn_cat)[\n  length(levels(raw_pa_data_pols$iucn_cat)):1\n]\nn_desig &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  pull(desig_eng) |&gt;\n  unique() |&gt;\n  length()\npas_count &lt;- raw_pa_data_pols |&gt;\n  filter(!str_detect(desig_eng, 'UNESCO-MAB')) |&gt;\n  st_drop_geometry() |&gt;\n  count(iucn_cat, desig_eng, realm) |&gt;\n  mutate(iucn_cat = factor(iucn_cat, levels = g_labels))\n\npalette_desig &lt;- paletteer::paletteer_c(\"scico::roma\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"viridis::viridis\", n = n_desig)\n# palette_desig &lt;- paletteer::paletteer_c(\"scico::batlow\", n = n_desig)\n\nggplotly(\n  pas_count |&gt;\n    arrange(iucn_cat) |&gt;\n    ggplot() +\n    aes(y = iucn_cat, x = n, fill = desig_eng) +\n    geom_col() +\n    labs(y = 'IUCN categories', x = 'Count') +\n    scale_fill_manual(\n      values = palette_desig,\n      # labels = \\(x) stringr::str_wrap(x, width = 32),\n      # 'Designation'\n    ) +\n    theme_minimal() +\n    theme(\n      legend.position = 'none',\n      plot.background = element_rect(fill = background_colour),\n      axis.title = element_text(family = 'worksans')\n    ) +\n    facet_wrap(~realm, scales = 'free')\n) \n\n\n\n\n\n\n\n\nCode\nselect(iucn_palette, -hex_colour)\n\n\n# A tibble: 10 × 2\n   id             cat                                                       \n   &lt;chr&gt;          &lt;chr&gt;                                                     \n 1 Ia             Ia Strict nature reserve                                  \n 2 Ib             Ib Wilderness area                                        \n 3 II             II National park                                          \n 4 III            III Natural monument or feature                           \n 5 IV             IV Habitat/species management area                        \n 6 V              V Protected landscape/seascape                            \n 7 VI             VI Protected area with sustainable use of natural resource\n 8 Not Applicable NA Not Applicable                                         \n 9 Not Assigned   NAS Not Assigned                                          \n10 Not Reported   NR Not Reported                                           \n\n\n\n\nCode\ncolours_desig &lt;- tibble(palette_desig, desig = sort(unique(pas_count$desig_eng)))\nprep &lt;- colours_desig |&gt;\n  select(colour = palette_desig, desig_eng = desig) |&gt; \n  right_join(pas_count)\n\nprep |&gt; \n  reactable(\n    showSortable = T,\n    defaultSorted = list(n = 'desc'),\n    searchable = TRUE,\n    defaultPageSize = 20,\n    showPageSizeOptions = TRUE,\n    pageSizeOptions = c(10, 20, 50, 100, nrow(pas_count)),\n    fullWidth = F,\n    columns = list(\n      colour = colDef(\n        sortable = F,\n        name = '',\n        maxWidth = 100,\n        style = function(value) {\n          colour &lt;- value\n          list(background = colour, color = colour)\n        }\n      ),\n      desig_eng = colDef(\n        name = 'Designation',\n        minWidth = 400\n      ),\n      realm = colDef(\n        name = 'Realm'\n      ),\n      iucn_cat = colDef(\n        name = 'IUCN (cat)',\n        minWidth = 150\n      ),\n      n = colDef(\n        name = 'Count'\n      )\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Turkmenistan</span>"
    ]
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "BirdLife International. 2025. Digital\nboundaries of key biodiversity areas from the world database of key\nbiodiversity areas\n\n\nHanson, J. O. 2022. Wdpar:\nInterface to the world database on protected areas, Journal of\nOpen Source Software, vol. 7, 4594\n\n\nHanson, J. O. 2024. Wdpar: Interface to the world\ndatabase on protected areas\n\n\nUNEP-WCMC and IUCN. 2024a. Protected planet: The world\ndatabase on other effective area-based conservation measures,\nCambridge, UK, UNEP-WCMC; IUCN\n\n\nUNEP-WCMC and IUCN. 2024b. Protected planet: The world\ndatabase on protected areas (WDPA), Cambridge, UK, UNEP-WCMC;\nIUCN",
    "crumbs": [
      "References"
    ]
  }
]